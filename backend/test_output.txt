============================= test session starts ==============================
platform darwin -- Python 3.11.4, pytest-9.0.2, pluggy-1.6.0 -- /Library/Frameworks/Python.framework/Versions/3.11/bin/python3.11
cachedir: .pytest_cache
rootdir: /Users/marcelkurvers/Development/funda-app
configfile: pytest.ini
plugins: anyio-4.10.0, asyncio-1.3.0
asyncio: mode=Mode.AUTO, debug=False, asyncio_default_fixture_loop_scope=None, asyncio_default_test_loop_scope=function
collecting ... collected 471 items

test_extraction.py::test_photo_extraction PASSED                         [  0%]
tests/e2e/test_frontend.py::TestFrontendStructure::test_01_index_html_structure PASSED [  0%]
tests/e2e/test_frontend.py::TestFrontendStructure::test_02_preferences_html_structure PASSED [  0%]
tests/e2e/test_invariant_enforcement.py::TestCoreInvariant::test_numeric_detection_catches_currency PASSED [  0%]
tests/e2e/test_invariant_enforcement.py::TestCoreInvariant::test_numeric_detection_catches_measurements PASSED [  1%]
tests/e2e/test_invariant_enforcement.py::TestCoreInvariant::test_numeric_detection_catches_percentages PASSED [  1%]
tests/e2e/test_invariant_enforcement.py::TestCoreInvariant::test_numeric_detection_catches_years PASSED [  1%]
tests/e2e/test_invariant_enforcement.py::TestCoreInvariant::test_numeric_detection_catches_large_numbers PASSED [  1%]
tests/e2e/test_invariant_enforcement.py::TestCoreInvariant::test_numeric_detection_allows_chapter_references PASSED [  1%]
tests/e2e/test_invariant_enforcement.py::TestCoreInvariant::test_numeric_detection_allows_interpretive_text PASSED [  2%]
tests/e2e/test_invariant_enforcement.py::TestCoreInvariant::test_valid_interpretation_passes_validation PASSED [  2%]
tests/e2e/test_invariant_enforcement.py::TestCoreInvariant::test_invalid_interpretation_with_numbers_fails PASSED [  2%]
tests/e2e/test_invariant_enforcement.py::TestCoreInvariant::test_schema_violation_raises_exception_in_strict_mode PASSED [  2%]
tests/e2e/test_invariant_enforcement.py::TestFactSafeRenderer::test_renderer_requires_locked_registry PASSED [  2%]
tests/e2e/test_invariant_enforcement.py::TestFactSafeRenderer::test_renderer_formats_facts_from_registry PASSED [  3%]
tests/e2e/test_invariant_enforcement.py::TestFactSafeRenderer::test_renderer_tracks_all_rendered_facts PASSED [  3%]
tests/e2e/test_invariant_enforcement.py::TestFactSafeRenderer::test_all_rendered_facts_originate_from_registry PASSED [  3%]
tests/e2e/test_invariant_enforcement.py::TestFactSafeRenderer::test_ai_interpretation_is_separate_from_facts PASSED [  3%]
tests/e2e/test_invariant_enforcement.py::TestFactSafeRenderer::test_removing_ai_does_not_change_facts PASSED [  4%]
tests/e2e/test_invariant_enforcement.py::TestConvergence::test_no_ai_output_contains_registry_values PASSED [  4%]
tests/e2e/test_invariant_enforcement.py::TestConvergence::test_all_facts_in_report_trace_to_registry PASSED [  4%]
tests/e2e/test_invariant_enforcement.py::TestConvergence::test_ai_failure_does_not_introduce_facts PASSED [  4%]
tests/e2e/test_invariant_enforcement.py::TestConvergence::test_schema_makes_fact_invention_impossible PASSED [  4%]
tests/e2e/test_invariant_enforcement.py::TestConvergence::test_unknown_registry_id_in_ai_output_fails PASSED [  5%]
tests/e2e/test_invariant_enforcement.py::TestRegressionPrevention::test_price_cannot_appear_in_ai_reasoning PASSED [  5%]
tests/e2e/test_invariant_enforcement.py::TestRegressionPrevention::test_area_cannot_appear_in_ai_reasoning PASSED [  5%]
tests/e2e/test_invariant_enforcement.py::TestRegressionPrevention::test_year_cannot_appear_in_ai_reasoning PASSED [  5%]
tests/e2e/test_invariant_enforcement.py::TestRegressionPrevention::test_interpretive_language_is_allowed PASSED [  5%]
tests/e2e/test_pdf_export.py::TestPDFExport::test_pdf_export_functionality PASSED [  6%]
tests/integration/test_comprehensive.py::TestComprehensive::test_all_chapters_generated PASSED [  6%]
tests/integration/test_comprehensive.py::TestComprehensive::test_energy_label_affects_chapter_4 PASSED [  6%]
tests/integration/test_comprehensive.py::TestComprehensive::test_enriched_core_contains_registry_values PASSED [  6%]
tests/integration/test_comprehensive.py::TestComprehensive::test_kpis_generated PASSED [  7%]
tests/integration/test_comprehensive.py::TestComprehensive::test_validation_status_tracked PASSED [  7%]
tests/integration/test_consistency.py::TestChapterConsistency::test_all_chapters_generated PASSED [  7%]
tests/integration/test_consistency.py::TestChapterConsistency::test_energy_label_in_enriched PASSED [  7%]
tests/integration/test_consistency.py::TestChapterConsistency::test_enriched_core_has_areas PASSED [  7%]
tests/integration/test_consistency.py::TestChapterConsistency::test_enriched_core_has_prices PASSED [  8%]
tests/integration/test_consistency.py::TestChapterConsistency::test_kpis_have_completeness PASSED [  8%]
tests/integration/test_docker_sync.py::TestDockerSync::test_docker_configuration_contract PASSED [  8%]
tests/integration/test_integration.py::TestIntegration::test_full_flow_with_paste PASSED [  8%]
tests/integration/test_integration_fixtures.py::TestFixturesOutput::test_fixtures_generation 
tests/integration/test_integration_fixtures.py::TestFixturesOutput::test_fixtures_generation PASSED [  8%]
tests/integration/test_registry_purity.py::TestRegistryPurity::test_registry_locked_before_chapter_generation PASSED [  9%]
tests/integration/test_registry_purity.py::TestRegistryPurity::test_no_new_entries_after_lock PASSED [  9%]
tests/integration/test_registry_purity.py::TestRegistryPurity::test_registry_values_immutable_after_lock PASSED [  9%]
tests/integration/test_registry_purity.py::TestRegistryPurity::test_chapter_output_values_come_from_registry PASSED [  9%]
tests/integration/test_registry_purity.py::TestRegistryPurity::test_registry_value_wrapper_blocks_arithmetic PASSED [  9%]
tests/integration/test_registry_purity.py::TestRegistryPurity::test_read_only_proxy_blocks_modification PASSED [ 10%]
tests/integration/test_registry_purity.py::TestRegistryPurity::test_fallback_narratives_contain_no_computation PASSED [ 10%]
tests/integration/test_registry_purity.py::TestRegistryPurity::test_intelligence_engine_uses_registry_fallback PASSED [ 10%]
tests/integration/test_registry_purity.py::TestRegistryPurity::test_enrichment_layer_is_only_computation_source PASSED [ 10%]
tests/integration/test_registry_purity.py::TestNoComputationInChapters::test_chapter_0_no_arithmetic_in_generate PASSED [ 11%]
tests/integration/test_registry_purity.py::TestPipelineIntegration::test_full_pipeline_without_ai_uses_registry_templates PASSED [ 11%]
tests/quality/test_audit_codebase.py::test_audit_codebase_for_mocks_and_hardcoded_items PASSED [ 11%]
tests/quality/test_dynamism.py::TestDynamism::test_dynamism_score_generation PASSED [ 11%]
tests/quality/test_real_data_architecture.py::test_layer_1_real_data_enrichment PASSED [ 11%]
tests/quality/test_real_data_architecture.py::test_layer_2_real_data_ownership PASSED [ 12%]
tests/quality/test_real_data_architecture.py::test_layer_4_real_data_validation PASSED [ 12%]
tests/quality/test_system_invariants.py::test_invariant_canonical_truth_integrity PASSED [ 12%]
tests/quality/test_system_invariants.py::test_invariant_no_duplication_across_pages PASSED [ 12%]
tests/quality/test_system_invariants.py::test_invariant_ownership_enforcement FAILED [ 12%]
tests/quality/test_system_invariants.py::test_invariant_ai_no_raw_restatement PASSED [ 13%]
tests/quality/test_system_invariants.py::test_invariant_preference_materiality PASSED [ 13%]
tests/quality/test_system_invariants.py::test_invariant_render_gate_blocks_failure PASSED [ 13%]
tests/test_ai_preference_matching.py::test_chapter_0_fallback_comparison PASSED [ 13%]
tests/test_ai_preference_matching.py::test_ai_preference_matching_with_real_ollama PASSED [ 14%]
tests/test_ai_preference_matching.py::test_real_provider_health_check PASSED [ 14%]
tests/test_ai_preference_matching.py::test_real_provider_model_listing PASSED [ 14%]
tests/test_ai_preference_matching.py::test_preference_integration_end_to_end PASSED [ 14%]
tests/test_ai_preference_matching.py::test_fallback_quality_without_ai PASSED [ 14%]
tests/test_dynamic_editorial.py::TestDynamicEditorial::test_smart_get_resolves_aliases PASSED [ 15%]
tests/test_dynamic_editorial.py::TestDynamicEditorial::test_chapter_0_market_pulse_dynamic_keys PASSED [ 15%]
tests/test_dynamic_editorial.py::TestDynamicEditorial::test_chapter_1_property_dna_dynamic_keys PASSED [ 15%]
tests/test_dynamic_editorial.py::TestDynamicEditorial::test_chapter_2_synergy_scores PASSED [ 15%]
tests/test_dynamic_editorial.py::TestDynamicEditorial::test_robustness_messy_input PASSED [ 15%]
tests/test_verify_consistency.py::test_consistency_check_happy_path PASSED [ 16%]
tests/test_verify_consistency.py::test_consistency_check_detects_price_mismatch PASSED [ 16%]
tests/test_verify_consistency.py::test_consistency_check_detects_label_mismatch PASSED [ 16%]
tests/test_worldclass_editorial.py::TestWorldClassEditorial::test_chapter_0_quality PASSED [ 16%]
tests/test_worldclass_editorial.py::TestWorldClassEditorial::test_pull_quote_extraction PASSED [ 16%]
tests/test_worldclass_editorial.py::TestWorldClassEditorial::test_visual_signposts PASSED [ 17%]
tests/test_worldclass_editorial.py::TestWorldClassEditorial::test_persona_styling PASSED [ 17%]
tests/test_worldclass_editorial.py::TestWorldClassEditorial::test_all_chapters_consecutively PASSED [ 17%]
tests/unit/test_ai_contracts.py::TestProviderContracts::test_all_providers_have_check_health_method PASSED [ 17%]
tests/unit/test_ai_contracts.py::TestProviderContracts::test_all_providers_have_close_method PASSED [ 18%]
tests/unit/test_ai_contracts.py::TestProviderContracts::test_all_providers_have_generate_method PASSED [ 18%]
tests/unit/test_ai_contracts.py::TestProviderContracts::test_all_providers_have_list_models_method PASSED [ 18%]
tests/unit/test_ai_contracts.py::TestProviderContracts::test_all_providers_have_name_property PASSED [ 18%]
tests/unit/test_ai_contracts.py::TestProviderContracts::test_anthropic_implements_interface PASSED [ 18%]
tests/unit/test_ai_contracts.py::TestProviderContracts::test_gemini_implements_interface PASSED [ 19%]
tests/unit/test_ai_contracts.py::TestProviderContracts::test_ollama_implements_interface PASSED [ 19%]
tests/unit/test_ai_contracts.py::TestProviderContracts::test_openai_implements_interface PASSED [ 19%]
tests/unit/test_ai_contracts.py::TestProviderConfiguration::test_anthropic_requires_api_key PASSED [ 19%]
tests/unit/test_ai_contracts.py::TestProviderConfiguration::test_gemini_requires_api_key PASSED [ 19%]
tests/unit/test_ai_contracts.py::TestProviderConfiguration::test_ollama_accepts_base_url_configuration PASSED [ 20%]
tests/unit/test_ai_contracts.py::TestProviderConfiguration::test_ollama_accepts_model_configuration PASSED [ 20%]
tests/unit/test_ai_contracts.py::TestProviderConfiguration::test_ollama_accepts_timeout_configuration PASSED [ 20%]
tests/unit/test_ai_contracts.py::TestProviderConfiguration::test_ollama_has_default_configuration PASSED [ 20%]
tests/unit/test_ai_contracts.py::TestProviderConfiguration::test_openai_requires_api_key PASSED [ 21%]
tests/unit/test_ai_contracts.py::TestProviderCapabilities::test_ollama_declares_supported_models PASSED [ 21%]
tests/unit/test_ai_contracts.py::TestProviderCapabilities::test_provider_name_is_lowercase PASSED [ 21%]
tests/unit/test_ai_contracts.py::TestProviderCapabilities::test_provider_name_is_unique_identifier PASSED [ 21%]
tests/unit/test_ai_contracts.py::TestProviderSchemaCompliance::test_configuration_properties_have_correct_types PASSED [ 21%]
tests/unit/test_ai_contracts.py::TestProviderSchemaCompliance::test_list_models_returns_list_of_strings PASSED [ 22%]
tests/unit/test_ai_contracts.py::TestProviderSchemaCompliance::test_name_property_returns_string PASSED [ 22%]
tests/unit/test_ai_interpretation.py::TestAiInterpretation::test_all_chapters_generation 
tests/unit/test_ai_interpretation.py::TestAiInterpretation::test_all_chapters_generation PASSED [ 22%]
tests/unit/test_ai_interpretation.py::TestAiInterpretation::test_html_structure_consistency PASSED [ 22%]
tests/unit/test_ai_interpretation.py::TestAiInterpretation::test_registry_template_provenance PASSED [ 22%]
tests/unit/test_ai_interpretation.py::TestAiInterpretation::test_scenario_luxury_villa PASSED [ 23%]
tests/unit/test_ai_interpretation.py::TestAiInterpretation::test_scenario_modern_eco_house PASSED [ 23%]
tests/unit/test_ai_interpretation.py::TestAiInterpretation::test_scenario_old_fixer_upper PASSED [ 23%]
tests/unit/test_ai_refactor.py::test_provider_factory_listing PASSED     [ 23%]
tests/unit/test_ai_refactor.py::test_provider_factory_creation_with_model PASSED [ 23%]
tests/unit/test_ai_refactor.py::test_api_ai_models_endpoint PASSED       [ 24%]
tests/unit/test_ai_refactor.py::test_preferences_sync_with_ai_settings PASSED [ 24%]
tests/unit/test_ai_routing.py::TestProviderRouting::test_factory_creates_anthropic_provider_with_key PASSED [ 24%]
tests/unit/test_ai_routing.py::TestProviderRouting::test_factory_creates_gemini_provider_with_key PASSED [ 24%]
tests/unit/test_ai_routing.py::TestProviderRouting::test_factory_creates_ollama_provider PASSED [ 25%]
tests/unit/test_ai_routing.py::TestProviderRouting::test_factory_creates_openai_provider_with_key PASSED [ 25%]
tests/unit/test_ai_routing.py::TestProviderRouting::test_factory_lists_all_registered_providers PASSED [ 25%]
tests/unit/test_ai_routing.py::TestProviderRouting::test_factory_passes_configuration_to_provider PASSED [ 25%]
tests/unit/test_ai_routing.py::TestProviderRouting::test_factory_rejects_unknown_provider PASSED [ 25%]
tests/unit/test_ai_routing.py::TestProviderRouting::test_provider_registry_contains_metadata PASSED [ 26%]
tests/unit/test_ai_routing.py::TestIntelligenceEngineProviderManagement::test_can_clear_provider PASSED [ 26%]
tests/unit/test_ai_routing.py::TestIntelligenceEngineProviderManagement::test_can_replace_provider PASSED [ 26%]
tests/unit/test_ai_routing.py::TestIntelligenceEngineProviderManagement::test_can_set_provider PASSED [ 26%]
tests/unit/test_ai_routing.py::TestIntelligenceEngineProviderManagement::test_provider_persists_across_calls PASSED [ 26%]
tests/unit/test_ai_routing.py::TestFallbackBehavior::test_fallback_data_is_realistic PASSED [ 27%]
tests/unit/test_ai_routing.py::TestFallbackBehavior::test_fallback_does_not_claim_ai_generation PASSED [ 27%]
tests/unit/test_ai_routing.py::TestFallbackBehavior::test_fallback_has_required_schema_fields PASSED [ 27%]
tests/unit/test_ai_routing.py::TestFallbackBehavior::test_fallback_works_for_all_chapters PASSED [ 27%]
tests/unit/test_ai_routing.py::TestFallbackBehavior::test_generates_fallback_when_no_provider_set PASSED [ 28%]
tests/unit/test_ai_routing.py::TestProviderStateTransitions::test_transition_between_different_providers PASSED [ 28%]
tests/unit/test_ai_routing.py::TestProviderStateTransitions::test_transition_from_no_provider_to_provider PASSED [ 28%]
tests/unit/test_ai_routing.py::TestProviderStateTransitions::test_transition_from_provider_to_no_provider PASSED [ 28%]
tests/unit/test_ai_schema.py::TestNarrativeOutputSchema::test_all_text_fields_are_non_empty PASSED [ 28%]
tests/unit/test_ai_schema.py::TestNarrativeOutputSchema::test_chapter_0_schema_compliance PASSED [ 29%]
tests/unit/test_ai_schema.py::TestNarrativeOutputSchema::test_chapter_1_schema_compliance PASSED [ 29%]
tests/unit/test_ai_schema.py::TestNarrativeOutputSchema::test_chapter_2_schema_compliance PASSED [ 29%]
tests/unit/test_ai_schema.py::TestNarrativeOutputSchema::test_chapter_4_schema_compliance PASSED [ 29%]
tests/unit/test_ai_schema.py::TestNarrativeOutputSchema::test_output_is_json_serializable PASSED [ 29%]
tests/unit/test_ai_schema.py::TestNarrativeOutputSchema::test_strengths_field_is_list_of_strings PASSED [ 30%]
tests/unit/test_ai_schema.py::TestNarrativeDataIntegration::test_chapter_0_handles_missing_data PASSED [ 30%]
tests/unit/test_ai_schema.py::TestNarrativeDataIntegration::test_chapter_4_energy_logic_green_label PASSED [ 30%]
tests/unit/test_ai_schema.py::TestNarrativeDataIntegration::test_chapter_4_energy_logic_poor_label PASSED [ 30%]
tests/unit/test_ai_schema.py::TestNarrativeDataIntegration::test_narrative_references_property_address PASSED [ 30%]
tests/unit/test_ai_schema.py::TestNarrativeDataIntegration::test_narrative_uses_actual_property_data PASSED [ 31%]
tests/unit/test_ai_schema.py::TestHelperFunctions::test_calculate_fit_score_moved_to_enrichment PASSED [ 31%]
tests/unit/test_ai_schema.py::TestHelperFunctions::test_parse_int_helper_with_area PASSED [ 31%]
tests/unit/test_ai_schema.py::TestHelperFunctions::test_parse_int_helper_with_invalid_input PASSED [ 31%]
tests/unit/test_ai_schema.py::TestHelperFunctions::test_parse_int_helper_with_numeric_input PASSED [ 32%]
tests/unit/test_ai_schema.py::TestHelperFunctions::test_parse_int_helper_with_price PASSED [ 32%]
tests/unit/test_ai_schema.py::TestHelperFunctions::test_parse_int_helper_with_year PASSED [ 32%]
tests/unit/test_ai_schema.py::TestSchemaConsistency::test_all_chapters_have_intro PASSED [ 32%]
tests/unit/test_ai_schema.py::TestSchemaConsistency::test_all_chapters_have_title PASSED [ 32%]
tests/unit/test_ai_schema.py::TestSchemaConsistency::test_all_chapters_return_dict PASSED [ 33%]
tests/unit/test_api_endpoints.py::TestApiEndpoints::test_create_run_defaults PASSED [ 33%]
tests/unit/test_api_endpoints.py::TestApiEndpoints::test_get_nonexistent_run PASSED [ 33%]
tests/unit/test_api_endpoints.py::TestApiEndpoints::test_health_check PASSED [ 33%]
tests/unit/test_api_endpoints.py::TestApiEndpoints::test_preferences_api PASSED [ 33%]
tests/unit/test_api_endpoints.py::TestApiEndpoints::test_start_run_updates_status PASSED [ 34%]
tests/unit/test_async_pipeline.py::TestAsyncPipeline::test_start_run_returns_immediately PASSED [ 34%]
tests/unit/test_async_pipeline.py::TestAsyncPipeline::test_status_polling_endpoint_exists PASSED [ 34%]
tests/unit/test_async_pipeline.py::TestAsyncPipeline::test_status_polling_progress_calculation PASSED [ 34%]
tests/unit/test_async_pipeline.py::TestAsyncPipeline::test_status_endpoint_404_for_nonexistent_run PASSED [ 35%]
tests/unit/test_async_pipeline.py::TestAsyncPipeline::test_pipeline_runs_in_background FAILED [ 35%]
tests/unit/test_async_pipeline.py::TestAsyncPipeline::test_multiple_concurrent_pipelines PASSED [ 35%]
tests/unit/test_async_pipeline.py::TestThreadExecutor::test_executor_exists PASSED [ 35%]
tests/unit/test_async_pipeline.py::TestThreadExecutor::test_simulate_pipeline_callable PASSED [ 35%]
tests/unit/test_async_pipeline.py::TestBackwardCompatibility::test_report_endpoint_still_works PASSED [ 36%]
tests/unit/test_async_pipeline.py::TestBackwardCompatibility::test_create_run_endpoint_unchanged PASSED [ 36%]
tests/unit/test_chapter_0_logic.py::TestChapter0Logic::test_address_cleanup PASSED [ 36%]
tests/unit/test_chapter_0_logic.py::TestChapter0Logic::test_robotic_currency PASSED [ 36%]
tests/unit/test_chapter_0_logic.py::TestChapter0Logic::test_metrics_structure PASSED [ 36%]
tests/unit/test_chapter_0_logic.py::TestChapter0Logic::test_hero_structure PASSED [ 37%]
tests/unit/test_chapter_0_logic.py::TestChapter0Logic::test_output_has_chapter_data PASSED [ 37%]
tests/unit/test_chapter_display_quality.py::TestChapterDisplayQuality::test_all_chapters_have_segments PASSED [ 37%]
tests/unit/test_chapter_display_quality.py::TestChapterDisplayQuality::test_chapter_0_exists PASSED [ 37%]
tests/unit/test_chapter_display_quality.py::TestChapterDisplayQuality::test_chapters_have_grid_layout PASSED [ 38%]
tests/unit/test_chapter_routines.py::TestChapterRoutines::test_chapter_file_correspondence 
tests/unit/test_chapter_routines.py::TestChapterRoutines::test_chapter_file_correspondence PASSED [ 38%]
tests/unit/test_chapter_routines.py::TestChapterRoutines::test_unique_layout_per_page PASSED [ 38%]
tests/unit/test_chapter_routines.py::TestChapterRoutines::test_z_generate_design_compliance_report PASSED [ 38%]
tests/unit/test_chapters.py::TestChapters::test_chapter_generation PASSED [ 38%]
tests/unit/test_chapters.py::TestChapters::test_chapter_registry PASSED  [ 39%]
tests/unit/test_complex_parsing.py::TestComplexParsing::test_no_classes_layout PASSED [ 39%]
tests/unit/test_config_api.py::test_get_full_config PASSED               [ 39%]
tests/unit/test_config_api.py::test_get_config_section PASSED            [ 39%]
tests/unit/test_config_api.py::test_get_config_section_not_found PASSED  [ 39%]
tests/unit/test_config_api.py::test_get_config_value PASSED              [ 40%]
tests/unit/test_config_api.py::test_update_config_bulk PASSED            [ 40%]
tests/unit/test_config_api.py::test_update_config_value PASSED           [ 40%]
tests/unit/test_config_api.py::test_update_config_invalid_section PASSED [ 40%]
tests/unit/test_config_api.py::test_update_config_invalid_key PASSED     [ 40%]
tests/unit/test_display_units.py::TestDisplayUnits::test_enriched_core_prices_are_numeric PASSED [ 41%]
tests/unit/test_display_units.py::TestDisplayUnits::test_kpis_have_correct_values PASSED [ 41%]
tests/unit/test_display_units.py::TestDisplayUnits::test_no_duplicate_m2_in_hero PASSED [ 41%]
tests/unit/test_display_units.py::TestDisplayUnits::test_no_duplicate_m2_in_metrics PASSED [ 41%]
tests/unit/test_domain_models.py::TestDomainModels::test_chapter_output_flexibility PASSED [ 42%]
tests/unit/test_domain_models.py::TestDomainModels::test_property_core_defaults PASSED [ 42%]
tests/unit/test_domain_models.py::TestDomainModels::test_ui_component_structure PASSED [ 42%]
tests/unit/test_dynamic_chapters.py::TestDynamicChapters::test_all_chapters_generate_modern_dashboard 
tests/unit/test_dynamic_chapters.py::TestDynamicChapters::test_all_chapters_generate_modern_dashboard PASSED [ 42%]
tests/unit/test_dynamic_chapters.py::TestDynamicChapters::test_chapter_titles PASSED [ 42%]
tests/unit/test_dynamic_chapters.py::TestDynamicChapters::test_dynamic_intelligence_integration PASSED [ 43%]
tests/unit/test_enforcement_laws.py::TestLawB_AICannotIntroduceUnregisteredKeys::test_ai_cannot_introduce_unknown_top_level_keys PASSED [ 43%]
tests/unit/test_enforcement_laws.py::TestLawB_AICannotIntroduceUnregisteredKeys::test_ai_cannot_introduce_unknown_variable_keys PASSED [ 43%]
tests/unit/test_enforcement_laws.py::TestLawB_AICannotIntroduceUnregisteredKeys::test_valid_output_passes PASSED [ 43%]
tests/unit/test_enforcement_laws.py::TestLawB_AICannotIntroduceUnregisteredKeys::test_non_strict_mode_strips_keys PASSED [ 43%]
tests/unit/test_enforcement_laws.py::TestLawA_NoSoftErrorsFromAI::test_intelligence_engine_does_not_call_validation_gate PASSED [ 44%]
tests/unit/test_enforcement_laws.py::TestLawA_NoSoftErrorsFromAI::test_intelligence_engine_does_not_return_error_content_dict PASSED [ 44%]
tests/unit/test_enforcement_laws.py::TestLawA_NoSoftErrorsFromAI::test_validation_only_at_spine_level PASSED [ 44%]
tests/unit/test_enforcement_laws.py::TestLawC_NoSyntheticVariableInjection::test_empty_ai_output_stays_empty PASSED [ 44%]
tests/unit/test_enforcement_laws.py::TestLawC_NoSyntheticVariableInjection::test_synthetic_injection_detected PASSED [ 45%]
tests/unit/test_enforcement_laws.py::TestLawC_NoSyntheticVariableInjection::test_intelligence_engine_no_longer_injects_defaults PASSED [ 45%]
tests/unit/test_enforcement_laws.py::TestLawD_FailClosedPersistence::test_invalid_report_not_stored_to_db PASSED [ 45%]
tests/unit/test_enforcement_laws.py::TestLawD_FailClosedPersistence::test_validation_failed_status_exists PASSED [ 45%]
tests/unit/test_enforcement_laws.py::TestLawD_FailClosedPersistence::test_chapters_not_written_when_validation_fails PASSED [ 45%]
tests/unit/test_enforcement_laws.py::TestLawE_TestModeIsolation::test_production_mode_is_default PASSED [ 46%]
tests/unit/test_enforcement_laws.py::TestLawE_TestModeIsolation::test_test_mode_requires_explicit_flag PASSED [ 46%]
tests/unit/test_enforcement_laws.py::TestLawE_TestModeIsolation::test_test_mode_outputs_are_marked PASSED [ 46%]
tests/unit/test_enforcement_laws.py::TestLawE_TestModeIsolation::test_production_outputs_not_marked PASSED [ 46%]
tests/unit/test_enforcement_laws.py::TestPipelineEnforcement::test_spine_enforces_validation_before_render PASSED [ 46%]
tests/unit/test_enforcement_laws.py::TestPipelineEnforcement::test_all_chapters_pass_through_validation_gate PASSED [ 47%]
tests/unit/test_explore_insights.py::TestExploreInsights::test_capture_chapter_insights PASSED [ 47%]
tests/unit/test_fail_closed_enforcement.py::TestBypassBlocked::test_build_chapters_raises_bypass_blocked PASSED [ 47%]
tests/unit/test_fail_closed_enforcement.py::TestBypassBlocked::test_importing_build_chapters_is_allowed_but_calling_is_not PASSED [ 47%]
tests/unit/test_fail_closed_enforcement.py::TestRegistryConflictsThrow::test_registry_conflict_raises_exception PASSED [ 47%]
tests/unit/test_fail_closed_enforcement.py::TestRegistryConflictsThrow::test_registry_idempotent_for_same_value PASSED [ 48%]
tests/unit/test_fail_closed_enforcement.py::TestRegistryLockingThrows::test_register_after_lock_raises PASSED [ 48%]
tests/unit/test_fail_closed_enforcement.py::TestRegistryLockingThrows::test_context_register_after_lock_raises PASSED [ 48%]
tests/unit/test_fail_closed_enforcement.py::TestProductionModeBlocking::test_production_mode_detection PASSED [ 48%]
tests/unit/test_fail_closed_enforcement.py::TestProductionModeBlocking::test_strict_render_blocks_invalid_chapters PASSED [ 49%]
tests/unit/test_fail_closed_enforcement.py::TestProductionModeBlocking::test_production_mode_forces_strict PASSED [ 49%]
tests/unit/test_fail_closed_enforcement.py::TestValidationGateMandatory::test_all_chapters_validated PASSED [ 49%]
tests/unit/test_fail_closed_enforcement.py::TestValidationGateMandatory::test_validation_errors_prevent_storage PASSED [ 49%]
tests/unit/test_fail_closed_enforcement.py::TestValidationGateMandatory::test_unvalidated_chapters_cannot_be_stored PASSED [ 49%]
tests/unit/test_fail_closed_enforcement.py::TestValidationGateCatchesViolations::test_ownership_violation_caught PASSED [ 50%]
tests/unit/test_fail_closed_enforcement.py::TestValidationGateCatchesViolations::test_raw_fact_restatement_caught PASSED [ 50%]
tests/unit/test_fail_closed_enforcement.py::TestValidationGateCatchesViolations::test_missing_required_fields_caught PASSED [ 50%]
tests/unit/test_fail_closed_enforcement.py::TestPipelinePhaseEnforcement::test_cannot_enrich_before_ingest PASSED [ 50%]
tests/unit/test_fail_closed_enforcement.py::TestPipelinePhaseEnforcement::test_cannot_generate_before_enrich PASSED [ 50%]
tests/unit/test_fail_closed_enforcement.py::TestPipelinePhaseEnforcement::test_cannot_render_before_generate PASSED [ 51%]
tests/unit/test_fail_closed_enforcement.py::TestPipelinePhaseEnforcement::test_cannot_generate_without_locked_registry PASSED [ 51%]
tests/unit/test_fail_closed_enforcement.py::TestCorrectExecutionPath::test_full_pipeline_executes_correctly PASSED [ 51%]
tests/unit/test_fail_closed_enforcement.py::TestCorrectExecutionPath::test_bridge_function_works PASSED [ 51%]
tests/unit/test_fail_closed_enforcement.py::TestEnforcementRemovalBreaksTests::test_registry_has_lock_method PASSED [ 52%]
tests/unit/test_fail_closed_enforcement.py::TestEnforcementRemovalBreaksTests::test_registry_has_is_locked_method PASSED [ 52%]
tests/unit/test_fail_closed_enforcement.py::TestEnforcementRemovalBreaksTests::test_context_has_validation_methods PASSED [ 52%]
tests/unit/test_fail_closed_enforcement.py::TestEnforcementRemovalBreaksTests::test_spine_has_phase_tracking PASSED [ 52%]
tests/unit/test_fail_closed_enforcement.py::TestEnforcementRemovalBreaksTests::test_validation_gate_exists_and_callable PASSED [ 52%]
tests/unit/test_frontend_compatibility.py::TestRegression::test_chapter_has_grid_layout PASSED [ 53%]
tests/unit/test_frontend_compatibility.py::TestRegression::test_chapter_has_title PASSED [ 53%]
tests/unit/test_frontend_compatibility.py::TestRegression::test_chapter_id_present PASSED [ 53%]
tests/unit/test_image_upload.py::TestImageUpload::test_upload_endpoint_exists PASSED [ 53%]
tests/unit/test_image_upload.py::TestImageUpload::test_upload_valid_image PASSED [ 53%]
tests/unit/test_image_upload.py::TestImageUpload::test_upload_jpg_image PASSED [ 54%]
tests/unit/test_image_upload.py::TestImageUpload::test_upload_non_image_file_rejected PASSED [ 54%]
tests/unit/test_image_upload.py::TestImageUpload::test_upload_oversized_image_rejected PASSED [ 54%]
tests/unit/test_image_upload.py::TestImageUpload::test_uploaded_file_is_accessible PASSED [ 54%]
tests/unit/test_image_upload.py::TestImageUpload::test_upload_generates_unique_filenames PASSED [ 54%]
tests/unit/test_image_upload.py::TestImageUpload::test_upload_preserves_file_extension PASSED [ 55%]
tests/unit/test_image_upload.py::TestImageUpload::test_upload_directory_exists PASSED [ 55%]
tests/unit/test_image_upload.py::TestImageUpload::test_upload_handles_special_characters_in_filename PASSED [ 55%]
tests/unit/test_image_upload.py::TestImageUploadIntegration::test_paste_with_media_urls PASSED [ 55%]
tests/unit/test_image_upload.py::TestImageUploadSecurity::test_upload_without_authentication PASSED [ 56%]
tests/unit/test_image_upload.py::TestImageUploadSecurity::test_path_traversal_prevention PASSED [ 56%]
tests/unit/test_intelligence.py::TestIntelligenceEngine::test_all_chapters_have_consistent_structure PASSED [ 56%]
tests/unit/test_intelligence.py::TestIntelligenceEngine::test_chapter_0_executive_summary PASSED [ 56%]
tests/unit/test_intelligence.py::TestIntelligenceEngine::test_chapter_4_energy_logic PASSED [ 56%]
tests/unit/test_intelligence.py::TestIntelligenceEngine::test_fallback_uses_registry_templates PASSED [ 57%]
tests/unit/test_intelligence.py::TestIntelligenceEngine::test_generate_chapter_narrative_structure PASSED [ 57%]
tests/unit/test_intelligence.py::TestIntelligenceEngine::test_parse_int_helper PASSED [ 57%]
tests/unit/test_modern_chapter.py::TestModernChapter::test_all_14_chapters_generated PASSED [ 57%]
tests/unit/test_modern_chapter.py::TestModernChapter::test_chapter_0_exists PASSED [ 57%]
tests/unit/test_modern_chapter.py::TestModernChapter::test_chapter_structure_modern PASSED [ 58%]
tests/unit/test_modern_chapter.py::TestModernChapter::test_chapters_have_validation_status PASSED [ 58%]
tests/unit/test_modern_chapter.py::TestModernChapter::test_energy_chapter_layout PASSED [ 58%]
tests/unit/test_modern_design_compliance.py::TestModernDesignCompliance::test_address_present_in_chapter_0 PASSED [ 58%]
tests/unit/test_modern_design_compliance.py::TestModernDesignCompliance::test_all_chapters_exist PASSED [ 59%]
tests/unit/test_modern_design_compliance.py::TestModernDesignCompliance::test_chapters_have_grid_layout_main PASSED [ 59%]
tests/unit/test_modern_design_compliance.py::TestModernDesignCompliance::test_chapters_have_required_structure 
tests/unit/test_modern_design_compliance.py::TestModernDesignCompliance::test_chapters_have_required_structure PASSED [ 59%]
tests/unit/test_modern_design_compliance.py::TestModernDesignCompliance::test_data_integrity_no_placeholders PASSED [ 59%]
tests/unit/test_narrative_enforcement.py::TestNarrativeContract::test_narrative_contract_requires_text PASSED [ 59%]
tests/unit/test_narrative_enforcement.py::TestNarrativeContract::test_narrative_contract_requires_word_count PASSED [ 60%]
tests/unit/test_narrative_enforcement.py::TestNarrativeContract::test_narrative_contract_valid PASSED [ 60%]
tests/unit/test_narrative_enforcement.py::TestNarrativeContract::test_validate_minimum_passes PASSED [ 60%]
tests/unit/test_narrative_enforcement.py::TestNarrativeContract::test_validate_minimum_fails PASSED [ 60%]
tests/unit/test_narrative_enforcement.py::TestNarrativeGenerator::test_generate_returns_narrative_output PASSED [ 60%]
tests/unit/test_narrative_enforcement.py::TestNarrativeGenerator::test_generate_meets_minimum_word_count PASSED [ 61%]
tests/unit/test_narrative_enforcement.py::TestNarrativeGenerator::test_generate_has_text PASSED [ 61%]
tests/unit/test_narrative_enforcement.py::TestNarrativeGenerator::test_narrative_word_count_matches_text PASSED [ 61%]
tests/unit/test_narrative_enforcement.py::TestNarrativeGenerator::test_validate_narrative_raises_on_short PASSED [ 61%]
tests/unit/test_narrative_enforcement.py::TestNarrativeGenerator::test_validate_narrative_passes_on_long PASSED [ 61%]
tests/unit/test_narrative_enforcement.py::TestValidationGateNarrative::test_validation_fails_when_narrative_missing PASSED [ 62%]
tests/unit/test_narrative_enforcement.py::TestValidationGateNarrative::test_validation_fails_when_narrative_too_short PASSED [ 62%]
tests/unit/test_narrative_enforcement.py::TestValidationGateNarrative::test_validation_passes_with_valid_narrative PASSED [ 62%]
tests/unit/test_narrative_enforcement.py::TestValidationGateNarrative::test_chapter_13_does_not_require_narrative PASSED [ 62%]
tests/unit/test_narrative_enforcement.py::TestNarrativeSystemPrompt::test_system_prompt_exists PASSED [ 63%]
tests/unit/test_narrative_enforcement.py::TestNarrativeSystemPrompt::test_system_prompt_mentions_300_words PASSED [ 63%]
tests/unit/test_narrative_enforcement.py::TestNarrativeSystemPrompt::test_system_prompt_forbids_bullets PASSED [ 63%]
tests/unit/test_narrative_enforcement.py::TestNarrativeSystemPrompt::test_system_prompt_specifies_output_format PASSED [ 63%]
tests/unit/test_narrative_enforcement.py::TestChapterGoals::test_all_chapters_have_goals PASSED [ 63%]
tests/unit/test_narrative_enforcement.py::TestChapterGoals::test_goals_are_descriptive PASSED [ 64%]
tests/unit/test_narrative_enforcement.py::TestNarrativeEnforcement::test_narrative_output_is_serializable PASSED [ 64%]
tests/unit/test_narrative_enforcement.py::TestNarrativeEnforcement::test_narrative_contract_in_chapter_output PASSED [ 64%]
tests/unit/test_narrative_quality.py::test_no_raw_data_dump_in_main_analysis PASSED [ 64%]
tests/unit/test_narrative_quality.py::test_no_double_persona_info PASSED [ 64%]
tests/unit/test_narrative_quality.py::test_editorial_prose_quality PASSED [ 65%]
tests/unit/test_narrative_quality.py::test_chapter_output_has_required_fields PASSED [ 65%]
tests/unit/test_narrative_quality.py::test_no_computation_in_narrative PASSED [ 65%]
tests/unit/test_ollama_integration.py::TestProviderIntegration::test_engine_accepts_different_provider_types PASSED [ 65%]
tests/unit/test_ollama_integration.py::TestProviderIntegration::test_engine_narrative_generation_with_provider_set PASSED [ 66%]
tests/unit/test_ollama_integration.py::TestProviderIntegration::test_engine_narrative_generation_without_provider PASSED [ 66%]
tests/unit/test_ollama_integration.py::TestProviderIntegration::test_provider_configuration_accessible_after_injection PASSED [ 66%]
tests/unit/test_ollama_integration.py::TestProviderIntegration::test_provider_identity_preserved_after_injection PASSED [ 66%]
tests/unit/test_ollama_integration.py::TestProviderIntegration::test_provider_injection_into_engine PASSED [ 66%]
tests/unit/test_ollama_integration.py::TestPreferenceIntegration::test_fit_score_calculation_in_enrichment PASSED [ 67%]
tests/unit/test_ollama_integration.py::TestPreferenceIntegration::test_preferences_included_in_context PASSED [ 67%]
tests/unit/test_ollama_integration.py::TestPreferenceIntegration::test_preferences_structure_preserved PASSED [ 67%]
tests/unit/test_ollama_integration.py::TestMultiChapterIntegration::test_chapter_specific_logic_integration PASSED [ 67%]
tests/unit/test_ollama_integration.py::TestMultiChapterIntegration::test_consistent_output_across_chapters PASSED [ 67%]
tests/unit/test_ollama_integration.py::TestMultiChapterIntegration::test_data_propagation_across_chapters PASSED [ 68%]
tests/unit/test_ollama_integration.py::TestProviderStateIsolation::test_provider_state_can_be_set_and_cleared PASSED [ 68%]
tests/unit/test_ollama_integration.py::TestProviderStateIsolation::test_provider_state_starts_clean PASSED [ 68%]
tests/unit/test_ollama_integration.py::TestErrorHandling::test_engine_handles_empty_context PASSED [ 68%]
tests/unit/test_ollama_integration.py::TestErrorHandling::test_engine_handles_missing_context_data PASSED [ 69%]
tests/unit/test_ollama_integration.py::TestErrorHandling::test_parse_int_handles_invalid_input PASSED [ 69%]
tests/unit/test_parser.py::TestParser::test_bedroom_extraction_from_rooms PASSED [ 69%]
tests/unit/test_parser.py::TestParser::test_comprehensive_field_extraction PASSED [ 69%]
tests/unit/test_parser.py::TestParser::test_cross_validation_bedrooms_vs_rooms PASSED [ 69%]
tests/unit/test_parser.py::TestParser::test_data_quality_report PASSED   [ 70%]
tests/unit/test_parser.py::TestParser::test_illogical_data_validation PASSED [ 70%]
tests/unit/test_parser.py::TestParser::test_parse_real_fixture PASSED    [ 70%]
tests/unit/test_parser.py::TestParser::test_parse_sample PASSED          [ 70%]
tests/unit/test_parser_edge_cases.py::TestParserEdgeCases::test_navigation_text_address_bug PASSED [ 70%]
tests/unit/test_parser_edge_cases.py::TestParserEdgeCases::test_photo_count_as_rooms_bug PASSED [ 71%]
tests/unit/test_parser_edge_cases.py::TestParserEdgeCases::test_suspicious_room_count_correction PASSED [ 71%]
tests/unit/test_parser_edge_cases.py::TestParserEdgeCases::test_duplicate_m2_display_fix PASSED [ 71%]
tests/unit/test_parser_edge_cases_additional.py::test_address_blocklist_ignored PASSED [ 71%]
tests/unit/test_parser_edge_cases_additional.py::test_bedroom_capping PASSED [ 71%]
tests/unit/test_preferences_compliance.py::TestPreferencesCompliance::test_chapter_2_provenance_indicates_registry_template PASSED [ 72%]
tests/unit/test_preferences_compliance.py::TestPreferencesCompliance::test_marcel_petra_preferences_match PASSED [ 72%]
tests/unit/test_preferences_compliance.py::TestPreferencesCompliance::test_missing_preferences_handling PASSED [ 72%]
tests/unit/test_preferenties_vergelijking.py::TestPreferentiesVergelijking::test_chapter_2_returns_valid_structure PASSED [ 72%]
tests/unit/test_preferenties_vergelijking.py::TestPreferentiesVergelijking::test_vergelijking_logica PASSED [ 73%]
tests/unit/test_provider_factory.py::TestProviderRegistry::test_list_providers_returns_all_registered PASSED [ 73%]
tests/unit/test_provider_factory.py::TestProviderRegistry::test_registry_contains_correct_classes PASSED [ 73%]
tests/unit/test_provider_factory.py::TestProviderRegistry::test_register_new_provider PASSED [ 73%]
tests/unit/test_provider_factory.py::TestProviderFactory::test_create_ollama_provider_default PASSED [ 73%]
tests/unit/test_provider_factory.py::TestProviderFactory::test_create_ollama_provider_custom_url PASSED [ 74%]
tests/unit/test_provider_factory.py::TestProviderFactory::test_create_ollama_provider_custom_timeout PASSED [ 74%]
tests/unit/test_provider_factory.py::TestProviderFactory::test_create_openai_provider_with_api_key PASSED [ 74%]
tests/unit/test_provider_factory.py::TestProviderFactory::test_create_openai_provider_without_api_key_raises_error PASSED [ 74%]
tests/unit/test_provider_factory.py::TestProviderFactory::test_create_anthropic_provider_with_api_key PASSED [ 74%]
tests/unit/test_provider_factory.py::TestProviderFactory::test_create_anthropic_provider_without_api_key_raises_error PASSED [ 75%]
tests/unit/test_provider_factory.py::TestProviderFactory::test_create_gemini_provider_with_api_key PASSED [ 75%]
tests/unit/test_provider_factory.py::TestProviderFactory::test_create_gemini_provider_without_api_key_raises_error PASSED [ 75%]
tests/unit/test_provider_factory.py::TestProviderFactory::test_create_unknown_provider_raises_error PASSED [ 75%]
tests/unit/test_provider_factory.py::TestProviderFactory::test_create_provider_with_extra_kwargs PASSED [ 76%]
tests/unit/test_provider_factory.py::TestProviderFactory::test_create_all_providers_with_valid_config PASSED [ 76%]
tests/unit/test_provider_factory.py::TestProviderFactory::test_provider_factory_respects_timeout_parameter PASSED [ 76%]
tests/unit/test_provider_factory.py::TestFactoryRegistryIntegration::test_factory_uses_registry_for_provider_lookup PASSED [ 76%]
tests/unit/test_provider_factory.py::TestFactoryRegistryIntegration::test_custom_provider_can_be_registered_and_created PASSED [ 76%]
tests/unit/test_provider_factory.py::TestFactoryRegistryIntegration::test_all_registered_providers_can_be_created PASSED [ 77%]
tests/unit/test_provider_factory.py::TestProviderFactoryErrorHandling::test_none_provider_name_raises_error PASSED [ 77%]
tests/unit/test_provider_factory.py::TestProviderFactoryErrorHandling::test_empty_provider_name_raises_error PASSED [ 77%]
tests/unit/test_provider_factory.py::TestProviderFactoryErrorHandling::test_case_sensitive_provider_names PASSED [ 77%]
tests/unit/test_provider_factory.py::TestProviderFactoryErrorHandling::test_helpful_error_message_lists_available_providers PASSED [ 77%]
tests/unit/test_providers.py::TestOllamaProvider::test_ollama_initialization_default PASSED [ 78%]
tests/unit/test_providers.py::TestOllamaProvider::test_ollama_initialization_custom_url PASSED [ 78%]
tests/unit/test_providers.py::TestOllamaProvider::test_ollama_initialization_env_var PASSED [ 78%]
tests/unit/test_providers.py::TestOllamaProvider::test_ollama_initialization_docker_env PASSED [ 78%]
tests/unit/test_providers.py::TestOllamaProvider::test_ollama_name_property PASSED [ 78%]
tests/unit/test_providers.py::TestOllamaProvider::test_ollama_list_models_success PASSED [ 79%]
tests/unit/test_providers.py::TestOllamaProvider::test_ollama_list_models_http_error PASSED [ 79%]
tests/unit/test_providers.py::TestOllamaProvider::test_ollama_list_models_connection_error PASSED [ 79%]
tests/unit/test_providers.py::TestOllamaProvider::test_ollama_generate_success PASSED [ 79%]
tests/unit/test_providers.py::TestOllamaProvider::test_ollama_generate_timeout PASSED [ 80%]
tests/unit/test_providers.py::TestOllamaProvider::test_ollama_check_health_success PASSED [ 80%]
tests/unit/test_providers.py::TestOllamaProvider::test_ollama_check_health_failure PASSED [ 80%]
tests/unit/test_providers.py::TestOpenAIProvider::test_openai_initialization_with_key PASSED [ 80%]
tests/unit/test_providers.py::TestOpenAIProvider::test_openai_initialization_from_env PASSED [ 80%]
tests/unit/test_providers.py::TestOpenAIProvider::test_openai_initialization_no_key_raises_error PASSED [ 81%]
tests/unit/test_providers.py::TestOpenAIProvider::test_openai_name_property PASSED [ 81%]
tests/unit/test_providers.py::TestOpenAIProvider::test_openai_list_models PASSED [ 81%]
tests/unit/test_providers.py::TestOpenAIProvider::test_openai_generate_success PASSED [ 81%]
tests/unit/test_providers.py::TestOpenAIProvider::test_openai_generate_with_json_mode PASSED [ 81%]
tests/unit/test_providers.py::TestOpenAIProvider::test_openai_generate_error_handling PASSED [ 82%]
tests/unit/test_providers.py::TestOpenAIProvider::test_openai_check_health_success PASSED [ 82%]
tests/unit/test_providers.py::TestOpenAIProvider::test_openai_check_health_failure PASSED [ 82%]
tests/unit/test_providers.py::TestAnthropicProvider::test_anthropic_initialization_with_key PASSED [ 82%]
tests/unit/test_providers.py::TestAnthropicProvider::test_anthropic_initialization_custom_timeout PASSED [ 83%]
tests/unit/test_providers.py::TestAnthropicProvider::test_anthropic_name_property PASSED [ 83%]
tests/unit/test_providers.py::TestAnthropicProvider::test_anthropic_list_models PASSED [ 83%]
tests/unit/test_providers.py::TestAnthropicProvider::test_anthropic_generate_success PASSED [ 83%]
tests/unit/test_providers.py::TestAnthropicProvider::test_anthropic_generate_with_json_mode PASSED [ 83%]
tests/unit/test_providers.py::TestAnthropicProvider::test_anthropic_generate_timeout_error PASSED [ 84%]
tests/unit/test_providers.py::TestAnthropicProvider::test_anthropic_check_health_success PASSED [ 84%]
tests/unit/test_providers.py::TestAnthropicProvider::test_anthropic_check_health_failure PASSED [ 84%]
tests/unit/test_providers.py::TestGeminiProvider::test_gemini_initialization_with_key PASSED [ 84%]
tests/unit/test_providers.py::TestGeminiProvider::test_gemini_initialization_from_google_env PASSED [ 84%]
tests/unit/test_providers.py::TestGeminiProvider::test_gemini_initialization_from_gemini_env PASSED [ 85%]
tests/unit/test_providers.py::TestGeminiProvider::test_gemini_initialization_no_key_raises_error PASSED [ 85%]
tests/unit/test_providers.py::TestGeminiProvider::test_gemini_name_property PASSED [ 85%]
tests/unit/test_providers.py::TestGeminiProvider::test_gemini_list_models PASSED [ 85%]
tests/unit/test_providers.py::TestGeminiProvider::test_gemini_generate_success PASSED [ 85%]
tests/unit/test_providers.py::TestGeminiProvider::test_gemini_generate_with_json_mode PASSED [ 86%]
tests/unit/test_providers.py::TestGeminiProvider::test_gemini_generate_error_handling PASSED [ 86%]
tests/unit/test_providers.py::TestGeminiProvider::test_gemini_check_health_success PASSED [ 86%]
tests/unit/test_providers.py::TestGeminiProvider::test_gemini_check_health_no_api_key PASSED [ 86%]
tests/unit/test_providers.py::TestGeminiProvider::test_gemini_check_health_failure PASSED [ 87%]
tests/unit/test_providers.py::TestProviderInterface::test_all_providers_implement_interface PASSED [ 87%]
tests/unit/test_providers.py::TestProviderInterface::test_all_providers_have_name_property PASSED [ 87%]
tests/unit/test_providers.py::TestMultiProviderIntegration::test_all_available_providers_can_generate PASSED [ 87%]
tests/unit/test_spine_enforcement.py::TestRegistrySingleton::test_registry_created_once_per_context PASSED [ 87%]
tests/unit/test_spine_enforcement.py::TestRegistrySingleton::test_cannot_replace_registry PASSED [ 88%]
tests/unit/test_spine_enforcement.py::TestRegistrySingleton::test_context_tracks_registration_state PASSED [ 88%]
tests/unit/test_spine_enforcement.py::TestRegistryLocking::test_cannot_register_after_lock PASSED [ 88%]
tests/unit/test_spine_enforcement.py::TestRegistryLocking::test_cannot_lock_twice PASSED [ 88%]
tests/unit/test_spine_enforcement.py::TestRegistryLocking::test_cannot_lock_before_enrichment PASSED [ 88%]
tests/unit/test_spine_enforcement.py::TestChapterGenerationRequiresLock::test_cannot_generate_chapter_before_lock PASSED [ 89%]
tests/unit/test_spine_enforcement.py::TestChapterGenerationRequiresLock::test_spine_enforces_phase_order PASSED [ 89%]
tests/unit/test_spine_enforcement.py::TestValidationEnforcement::test_validation_runs_for_every_chapter PASSED [ 89%]
tests/unit/test_spine_enforcement.py::TestValidationEnforcement::test_validation_errors_are_recorded PASSED [ 89%]
tests/unit/test_spine_enforcement.py::TestValidationEnforcement::test_cannot_store_failed_chapter PASSED [ 90%]
tests/unit/test_spine_enforcement.py::TestValidationEnforcement::test_cannot_store_unvalidated_chapter PASSED [ 90%]
tests/unit/test_spine_enforcement.py::TestRawDataImmutability::test_cannot_modify_raw_data_after_enrichment PASSED [ 90%]
tests/unit/test_spine_enforcement.py::TestRawDataImmutability::test_get_raw_data_returns_copy PASSED [ 90%]
tests/unit/test_spine_enforcement.py::TestRenderBlocking::test_strict_render_blocks_on_failure PASSED [ 90%]
tests/unit/test_spine_enforcement.py::TestRenderBlocking::test_non_strict_render_includes_error_markers PASSED [ 91%]
tests/unit/test_spine_enforcement.py::TestFullPipelineExecution::test_execute_pipeline_returns_structured_output PASSED [ 91%]
tests/unit/test_spine_enforcement.py::TestFullPipelineExecution::test_pipeline_preserves_registry_values PASSED [ 91%]
tests/unit/test_spine_enforcement.py::TestFullPipelineExecution::test_pipeline_locks_registry PASSED [ 91%]
tests/unit/test_spine_enforcement.py::TestValidationGate::test_ownership_violation_detected PASSED [ 91%]
tests/unit/test_spine_enforcement.py::TestValidationGate::test_raw_fact_restatement_detected PASSED [ 92%]
tests/unit/test_spine_enforcement.py::TestValidationGate::test_preference_reasoning_required PASSED [ 92%]
tests/unit/test_spine_enforcement.py::TestValidationGate::test_valid_chapter_passes PASSED [ 92%]
tests/unit/test_system_architecture.py::TestSystemArchitecture::test_layer_1_registry PASSED [ 92%]
tests/unit/test_system_architecture.py::TestSystemArchitecture::test_layer_2_ownership PASSED [ 92%]
tests/unit/test_system_architecture.py::TestSystemArchitecture::test_layer_4_validation PASSED [ 93%]
tests/unit/test_utils.py::TestParsingUtilities::test_parse_float_invalid PASSED [ 93%]
tests/unit/test_utils.py::TestParsingUtilities::test_parse_float_valid PASSED [ 93%]
tests/unit/test_utils.py::TestParsingUtilities::test_parse_int_custom_default PASSED [ 93%]
tests/unit/test_utils.py::TestParsingUtilities::test_parse_int_formatted_numbers PASSED [ 94%]
tests/unit/test_utils.py::TestParsingUtilities::test_parse_int_invalid_inputs PASSED [ 94%]
tests/unit/test_utils.py::TestParsingUtilities::test_parse_int_valid_numbers PASSED [ 94%]
tests/unit/test_utils.py::TestValidationUtilities::test_validate_bedrooms_explicit_count PASSED [ 94%]
tests/unit/test_utils.py::TestValidationUtilities::test_validate_bedrooms_minimum PASSED [ 94%]
tests/unit/test_utils.py::TestValidationUtilities::test_validate_bedrooms_normal_range PASSED [ 95%]
tests/unit/test_utils.py::TestValidationUtilities::test_validate_bedrooms_upper_bound PASSED [ 95%]
tests/unit/test_utils.py::TestValidationUtilities::test_validate_living_area_bounds PASSED [ 95%]
tests/unit/test_utils.py::TestValidationUtilities::test_validate_living_area_normal PASSED [ 95%]
tests/unit/test_utils.py::TestSafetyUtilities::test_ensure_grid_layout_existing PASSED [ 95%]
tests/unit/test_utils.py::TestSafetyUtilities::test_ensure_grid_layout_missing PASSED [ 96%]
tests/unit/test_utils.py::TestSafetyUtilities::test_safe_get_existing_key PASSED [ 96%]
tests/unit/test_utils.py::TestSafetyUtilities::test_safe_get_missing_key PASSED [ 96%]
tests/unit/test_utils.py::TestSafetyUtilities::test_safe_get_none_value PASSED [ 96%]
tests/unit/test_utils.py::TestEdgeCases::test_parse_int_extreme_values PASSED [ 97%]
tests/unit/test_utils.py::TestEdgeCases::test_validate_bedrooms_edge_cases PASSED [ 97%]
tests/unit/test_utils.py::TestEdgeCases::test_validate_living_area_warnings PASSED [ 97%]
tests/unit/test_variable_strategy.py::TestPropertyCoreData::test_property_core_creation PASSED [ 97%]
tests/unit/test_variable_strategy.py::TestPropertyCoreData::test_preference_matching_marcel PASSED [ 97%]
tests/unit/test_variable_strategy.py::TestPropertyCoreData::test_preference_matching_petra PASSED [ 98%]
tests/unit/test_variable_strategy.py::TestPropertyCoreData::test_combined_match_score PASSED [ 98%]
tests/unit/test_variable_strategy.py::TestPropertyCoreData::test_preference_indicator_generation PASSED [ 98%]
tests/unit/test_variable_strategy.py::TestChapterVariableStrategy::test_chapter_0_shows_core_data PASSED [ 98%]
tests/unit/test_variable_strategy.py::TestChapterVariableStrategy::test_other_chapters_hide_core_data PASSED [ 98%]
tests/unit/test_variable_strategy.py::TestChapterVariableStrategy::test_chapter_2_preference_variables PASSED [ 99%]
tests/unit/test_variable_strategy.py::TestChapterVariableStrategy::test_variable_filtering PASSED [ 99%]
tests/unit/test_variable_strategy.py::TestChapterVariableStrategy::test_ai_prompt_generation PASSED [ 99%]
tests/unit/test_variable_strategy.py::TestChapterVariableStrategy::test_no_variable_overlap PASSED [ 99%]
tests/unit/test_variable_strategy.py::TestIntegration::test_complete_flow PASSED [100%]

=================================== FAILURES ===================================
_____________________ test_invariant_ownership_enforcement _____________________
tests/quality/test_system_invariants.py:164: in test_invariant_ownership_enforcement
    assert not errors_good, f"FAIL: Valid ownership flagged as error: {errors_good}"
E   AssertionError: FAIL: Valid ownership flagged as error: ["Narrative Missing: Chapter 7 has no 'narrative' field. Every chapter (0-12) MUST have a narrative of at least 300 words. This is NOT optional."]
E   assert not ["Narrative Missing: Chapter 7 has no 'narrative' field. Every chapter (0-12) MUST have a narrative of at least 300 words. This is NOT optional."]
------------------------------ Captured log call -------------------------------
WARNING  backend.validation.gate:gate.py:91 ValidationGate: Chapter 7 failed with 4 errors
WARNING  backend.validation.gate:gate.py:91 ValidationGate: Chapter 7 failed with 1 errors
______________ TestAsyncPipeline.test_pipeline_runs_in_background ______________
tests/unit/test_async_pipeline.py:133: in test_pipeline_runs_in_background
    assert json_status["status"] in ["done", "error", "running"], f"Unexpected status: {json_status['status']}"
E   AssertionError: Unexpected status: queued
E   assert 'queued' in ['done', 'error', 'running']
----------------------------- Captured stdout call -----------------------------
Pipeline still processing with status: {'run_id': 'c0c464fa-1900-4bc8-b8ca-43c2243732de', 'status': 'queued', 'steps': {'scrape_funda': 'done', 'dynamic_extraction': 'running', 'compute_kpis': 'pending', 'generate_chapters': 'pending', 'render_pdf': 'pending'}, 'progress': {'current': 1, 'total': 5, 'percent': 20}, 'unknowns': [], 'artifacts': [], 'updated_at': '2025-12-24 14:35:44'}
------------------------------ Captured log call -------------------------------
WARNING  consistency:consistency.py:164 Consistency Issues: 3 fields mismatch.
=========================== short test summary info ============================
FAILED tests/quality/test_system_invariants.py::test_invariant_ownership_enforcement
FAILED tests/unit/test_async_pipeline.py::TestAsyncPipeline::test_pipeline_runs_in_background
======== 2 failed, 469 passed, 9 warnings, 57 subtests passed in 46.56s ========
Ollama generation failed: 
DynamicExtractor: Extraction pipeline error: Ollama failed: 
Consistency Issues: 3 fields mismatch.
Ollama generation failed: cannot schedule new futures after interpreter shutdown
DynamicExtractor: Extraction pipeline error: Ollama failed: cannot schedule new futures after interpreter shutdown
Consistency Issues: 3 fields mismatch.
Ollama generation failed: cannot schedule new futures after interpreter shutdown
DynamicExtractor: Extraction pipeline error: Ollama failed: cannot schedule new futures after interpreter shutdown
Consistency Issues: 3 fields mismatch.
Ollama generation failed: 
DynamicExtractor: Extraction pipeline error: Ollama failed: 
