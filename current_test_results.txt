============================= test session starts ==============================
platform darwin -- Python 3.11.4, pytest-9.0.2, pluggy-1.6.0 -- /Library/Frameworks/Python.framework/Versions/3.11/bin/python3
cachedir: .pytest_cache
rootdir: /Users/marcelkurvers/Development/funda-app
configfile: pytest.ini
plugins: anyio-4.10.0, asyncio-1.3.0
asyncio: mode=Mode.AUTO, debug=False, asyncio_default_fixture_loop_scope=None, asyncio_default_test_loop_scope=function
collecting ... collected 310 items

backend/tests/e2e/test_frontend.py::TestFrontendStructure::test_01_index_html_structure PASSED [  0%]
backend/tests/e2e/test_frontend.py::TestFrontendStructure::test_02_preferences_html_structure PASSED [  0%]
backend/tests/e2e/test_pdf_export.py::TestPDFExport::test_pdf_export_functionality PASSED [  0%]
backend/tests/integration/test_comprehensive.py::TestComprehensive::test_all_chapters_generated PASSED [  1%]
backend/tests/integration/test_comprehensive.py::TestComprehensive::test_energy_label_logic PASSED [  1%]
backend/tests/integration/test_comprehensive.py::TestComprehensive::test_kpi_calculations_robustness PASSED [  1%]
backend/tests/integration/test_consistency.py::TestChapterConsistency::test_bedroom_logic PASSED [  2%]
backend/tests/integration/test_consistency.py::TestChapterConsistency::test_content_text_consistency PASSED [  2%]
backend/tests/integration/test_consistency.py::TestChapterConsistency::test_energy_label_consistency PASSED [  2%]
backend/tests/integration/test_consistency.py::TestChapterConsistency::test_living_area_consistency PASSED [  3%]
backend/tests/integration/test_consistency.py::TestChapterConsistency::test_price_consistency PASSED [  3%]
backend/tests/integration/test_consistency.py::TestChapterConsistency::test_sqm_price_consistency PASSED [  3%]
backend/tests/integration/test_docker_sync.py::TestDockerSync::test_ensure_latest_docker_build FAILED [  4%]
backend/tests/integration/test_integration.py::TestIntegration::test_full_flow_with_paste FAILED [  4%]
backend/tests/integration/test_integration_fixtures.py::TestFixturesOutput::test_fixtures_generation 
backend/tests/integration/test_integration_fixtures.py::TestFixturesOutput::test_fixtures_generation PASSED [  4%]
backend/tests/quality/test_audit_codebase.py::test_audit_codebase_for_mocks_and_hardcoded_items PASSED [  5%]
backend/tests/quality/test_dynamism.py::TestDynamism::test_dynamism_score_generation PASSED [  5%]
backend/tests/test_ai_preference_matching.py::test_chapter_0_fallback_comparison FAILED [  5%]
backend/tests/test_ai_preference_matching.py::test_ai_preference_matching_with_real_ollama PASSED [  6%]
backend/tests/test_ai_preference_matching.py::test_real_provider_health_check PASSED [  6%]
backend/tests/test_ai_preference_matching.py::test_real_provider_model_listing PASSED [  6%]
backend/tests/test_ai_preference_matching.py::test_preference_integration_end_to_end PASSED [  7%]
backend/tests/test_ai_preference_matching.py::test_fallback_quality_without_ai PASSED [  7%]
backend/tests/test_verify_consistency.py::test_consistency_check_happy_path PASSED [  7%]
backend/tests/test_verify_consistency.py::test_consistency_check_detects_price_mismatch PASSED [  8%]
backend/tests/test_verify_consistency.py::test_consistency_check_detects_label_mismatch PASSED [  8%]
backend/tests/test_worldclass_editorial.py::TestWorldClassEditorial::test_chapter_0_quality PASSED [  8%]
backend/tests/test_worldclass_editorial.py::TestWorldClassEditorial::test_pull_quote_extraction PASSED [  9%]
backend/tests/test_worldclass_editorial.py::TestWorldClassEditorial::test_visual_signposts PASSED [  9%]
backend/tests/test_worldclass_editorial.py::TestWorldClassEditorial::test_persona_styling PASSED [  9%]
backend/tests/test_worldclass_editorial.py::TestWorldClassEditorial::test_all_chapters_consecutively PASSED [ 10%]
backend/tests/unit/test_ai_contracts.py::TestProviderContracts::test_all_providers_have_check_health_method PASSED [ 10%]
backend/tests/unit/test_ai_contracts.py::TestProviderContracts::test_all_providers_have_close_method PASSED [ 10%]
backend/tests/unit/test_ai_contracts.py::TestProviderContracts::test_all_providers_have_generate_method PASSED [ 10%]
backend/tests/unit/test_ai_contracts.py::TestProviderContracts::test_all_providers_have_list_models_method PASSED [ 11%]
backend/tests/unit/test_ai_contracts.py::TestProviderContracts::test_all_providers_have_name_property PASSED [ 11%]
backend/tests/unit/test_ai_contracts.py::TestProviderContracts::test_anthropic_implements_interface PASSED [ 11%]
backend/tests/unit/test_ai_contracts.py::TestProviderContracts::test_gemini_implements_interface PASSED [ 12%]
backend/tests/unit/test_ai_contracts.py::TestProviderContracts::test_ollama_implements_interface PASSED [ 12%]
backend/tests/unit/test_ai_contracts.py::TestProviderContracts::test_openai_implements_interface PASSED [ 12%]
backend/tests/unit/test_ai_contracts.py::TestProviderConfiguration::test_anthropic_requires_api_key PASSED [ 13%]
backend/tests/unit/test_ai_contracts.py::TestProviderConfiguration::test_gemini_requires_api_key PASSED [ 13%]
backend/tests/unit/test_ai_contracts.py::TestProviderConfiguration::test_ollama_accepts_base_url_configuration PASSED [ 13%]
backend/tests/unit/test_ai_contracts.py::TestProviderConfiguration::test_ollama_accepts_model_configuration PASSED [ 14%]
backend/tests/unit/test_ai_contracts.py::TestProviderConfiguration::test_ollama_accepts_timeout_configuration PASSED [ 14%]
backend/tests/unit/test_ai_contracts.py::TestProviderConfiguration::test_ollama_has_default_configuration PASSED [ 14%]
backend/tests/unit/test_ai_contracts.py::TestProviderConfiguration::test_openai_requires_api_key PASSED [ 15%]
backend/tests/unit/test_ai_contracts.py::TestProviderCapabilities::test_ollama_declares_supported_models PASSED [ 15%]
backend/tests/unit/test_ai_contracts.py::TestProviderCapabilities::test_provider_name_is_lowercase PASSED [ 15%]
backend/tests/unit/test_ai_contracts.py::TestProviderCapabilities::test_provider_name_is_unique_identifier PASSED [ 16%]
backend/tests/unit/test_ai_contracts.py::TestProviderSchemaCompliance::test_configuration_properties_have_correct_types PASSED [ 16%]
backend/tests/unit/test_ai_contracts.py::TestProviderSchemaCompliance::test_list_models_returns_list_of_strings PASSED [ 16%]
backend/tests/unit/test_ai_contracts.py::TestProviderSchemaCompliance::test_name_property_returns_string PASSED [ 17%]
backend/tests/unit/test_ai_interpretation.py::TestAiInterpretation::test_all_chapters_generation 
backend/tests/unit/test_ai_interpretation.py::TestAiInterpretation::test_all_chapters_generation PASSED [ 17%]
backend/tests/unit/test_ai_interpretation.py::TestAiInterpretation::test_html_structure_consistency PASSED [ 17%]
backend/tests/unit/test_ai_interpretation.py::TestAiInterpretation::test_scenario_luxury_villa PASSED [ 18%]
backend/tests/unit/test_ai_interpretation.py::TestAiInterpretation::test_scenario_modern_eco_house PASSED [ 18%]
backend/tests/unit/test_ai_interpretation.py::TestAiInterpretation::test_scenario_old_fixer_upper PASSED [ 18%]
backend/tests/unit/test_ai_refactor.py::test_provider_factory_listing PASSED [ 19%]
backend/tests/unit/test_ai_refactor.py::test_provider_factory_creation_with_model PASSED [ 19%]
backend/tests/unit/test_ai_refactor.py::test_api_ai_models_endpoint PASSED [ 19%]
backend/tests/unit/test_ai_refactor.py::test_preferences_sync_with_ai_settings PASSED [ 20%]
backend/tests/unit/test_ai_routing.py::TestProviderRouting::test_factory_creates_anthropic_provider_with_key PASSED [ 20%]
backend/tests/unit/test_ai_routing.py::TestProviderRouting::test_factory_creates_gemini_provider_with_key PASSED [ 20%]
backend/tests/unit/test_ai_routing.py::TestProviderRouting::test_factory_creates_ollama_provider PASSED [ 20%]
backend/tests/unit/test_ai_routing.py::TestProviderRouting::test_factory_creates_openai_provider_with_key PASSED [ 21%]
backend/tests/unit/test_ai_routing.py::TestProviderRouting::test_factory_lists_all_registered_providers PASSED [ 21%]
backend/tests/unit/test_ai_routing.py::TestProviderRouting::test_factory_passes_configuration_to_provider PASSED [ 21%]
backend/tests/unit/test_ai_routing.py::TestProviderRouting::test_factory_rejects_unknown_provider PASSED [ 22%]
backend/tests/unit/test_ai_routing.py::TestProviderRouting::test_provider_registry_contains_metadata PASSED [ 22%]
backend/tests/unit/test_ai_routing.py::TestIntelligenceEngineProviderManagement::test_can_clear_provider PASSED [ 22%]
backend/tests/unit/test_ai_routing.py::TestIntelligenceEngineProviderManagement::test_can_replace_provider PASSED [ 23%]
backend/tests/unit/test_ai_routing.py::TestIntelligenceEngineProviderManagement::test_can_set_provider PASSED [ 23%]
backend/tests/unit/test_ai_routing.py::TestIntelligenceEngineProviderManagement::test_provider_persists_across_calls PASSED [ 23%]
backend/tests/unit/test_ai_routing.py::TestFallbackBehavior::test_fallback_data_is_realistic PASSED [ 24%]
backend/tests/unit/test_ai_routing.py::TestFallbackBehavior::test_fallback_does_not_claim_ai_generation PASSED [ 24%]
backend/tests/unit/test_ai_routing.py::TestFallbackBehavior::test_fallback_has_required_schema_fields PASSED [ 24%]
backend/tests/unit/test_ai_routing.py::TestFallbackBehavior::test_fallback_works_for_all_chapters PASSED [ 25%]
backend/tests/unit/test_ai_routing.py::TestFallbackBehavior::test_generates_fallback_when_no_provider_set PASSED [ 25%]
backend/tests/unit/test_ai_routing.py::TestProviderStateTransitions::test_transition_between_different_providers PASSED [ 25%]
backend/tests/unit/test_ai_routing.py::TestProviderStateTransitions::test_transition_from_no_provider_to_provider PASSED [ 26%]
backend/tests/unit/test_ai_routing.py::TestProviderStateTransitions::test_transition_from_provider_to_no_provider PASSED [ 26%]
backend/tests/unit/test_ai_schema.py::TestNarrativeOutputSchema::test_all_text_fields_are_non_empty FAILED [ 26%]
backend/tests/unit/test_ai_schema.py::TestNarrativeOutputSchema::test_chapter_0_schema_compliance PASSED [ 27%]
backend/tests/unit/test_ai_schema.py::TestNarrativeOutputSchema::test_chapter_1_schema_compliance FAILED [ 27%]
backend/tests/unit/test_ai_schema.py::TestNarrativeOutputSchema::test_chapter_2_schema_compliance PASSED [ 27%]
backend/tests/unit/test_ai_schema.py::TestNarrativeOutputSchema::test_chapter_4_schema_compliance PASSED [ 28%]
backend/tests/unit/test_ai_schema.py::TestNarrativeOutputSchema::test_output_is_json_serializable PASSED [ 28%]
backend/tests/unit/test_ai_schema.py::TestNarrativeOutputSchema::test_strengths_field_is_list_of_strings PASSED [ 28%]
backend/tests/unit/test_ai_schema.py::TestNarrativeDataIntegration::test_chapter_0_handles_missing_data PASSED [ 29%]
backend/tests/unit/test_ai_schema.py::TestNarrativeDataIntegration::test_chapter_4_energy_logic_green_label PASSED [ 29%]
backend/tests/unit/test_ai_schema.py::TestNarrativeDataIntegration::test_chapter_4_energy_logic_poor_label PASSED [ 29%]
backend/tests/unit/test_ai_schema.py::TestNarrativeDataIntegration::test_narrative_references_property_address PASSED [ 30%]
backend/tests/unit/test_ai_schema.py::TestNarrativeDataIntegration::test_narrative_uses_actual_property_data PASSED [ 30%]
backend/tests/unit/test_ai_schema.py::TestHelperFunctions::test_calculate_fit_score_returns_float PASSED [ 30%]
backend/tests/unit/test_ai_schema.py::TestHelperFunctions::test_parse_int_helper_with_area FAILED [ 30%]
backend/tests/unit/test_ai_schema.py::TestHelperFunctions::test_parse_int_helper_with_invalid_input PASSED [ 31%]
backend/tests/unit/test_ai_schema.py::TestHelperFunctions::test_parse_int_helper_with_numeric_input PASSED [ 31%]
backend/tests/unit/test_ai_schema.py::TestHelperFunctions::test_parse_int_helper_with_price PASSED [ 31%]
backend/tests/unit/test_ai_schema.py::TestHelperFunctions::test_parse_int_helper_with_year PASSED [ 32%]
backend/tests/unit/test_ai_schema.py::TestSchemaConsistency::test_all_chapters_have_intro PASSED [ 32%]
backend/tests/unit/test_ai_schema.py::TestSchemaConsistency::test_all_chapters_have_title PASSED [ 32%]
backend/tests/unit/test_ai_schema.py::TestSchemaConsistency::test_all_chapters_return_dict PASSED [ 33%]
backend/tests/unit/test_api_endpoints.py::TestApiEndpoints::test_create_run_defaults PASSED [ 33%]
backend/tests/unit/test_api_endpoints.py::TestApiEndpoints::test_get_nonexistent_run PASSED [ 33%]
backend/tests/unit/test_api_endpoints.py::TestApiEndpoints::test_health_check PASSED [ 34%]
backend/tests/unit/test_api_endpoints.py::TestApiEndpoints::test_preferences_api PASSED [ 34%]
backend/tests/unit/test_api_endpoints.py::TestApiEndpoints::test_start_run_updates_status PASSED [ 34%]
backend/tests/unit/test_async_pipeline.py::TestAsyncPipeline::test_start_run_returns_immediately PASSED [ 35%]
backend/tests/unit/test_async_pipeline.py::TestAsyncPipeline::test_status_polling_endpoint_exists PASSED [ 35%]
backend/tests/unit/test_async_pipeline.py::TestAsyncPipeline::test_status_polling_progress_calculation PASSED [ 35%]
backend/tests/unit/test_async_pipeline.py::TestAsyncPipeline::test_status_endpoint_404_for_nonexistent_run PASSED [ 36%]
backend/tests/unit/test_async_pipeline.py::TestAsyncPipeline::test_pipeline_runs_in_background PASSED [ 36%]
backend/tests/unit/test_async_pipeline.py::TestAsyncPipeline::test_multiple_concurrent_pipelines PASSED [ 36%]
backend/tests/unit/test_async_pipeline.py::TestThreadExecutor::test_executor_exists PASSED [ 37%]
backend/tests/unit/test_async_pipeline.py::TestThreadExecutor::test_simulate_pipeline_callable PASSED [ 37%]
backend/tests/unit/test_async_pipeline.py::TestBackwardCompatibility::test_report_endpoint_still_works PASSED [ 37%]
backend/tests/unit/test_async_pipeline.py::TestBackwardCompatibility::test_create_run_endpoint_unchanged PASSED [ 38%]
backend/tests/unit/test_chapter_0_logic.py::TestChapter0Logic::test_address_cleanup PASSED [ 38%]
backend/tests/unit/test_chapter_0_logic.py::TestChapter0Logic::test_robotic_currency PASSED [ 38%]
backend/tests/unit/test_chapter_0_logic.py::TestChapter0Logic::test_maintenance_consistency PASSED [ 39%]
backend/tests/unit/test_chapter_display_quality.py::TestChapterDisplayQuality::test_all_chapters_have_segments PASSED [ 39%]
backend/tests/unit/test_chapter_display_quality.py::TestChapterDisplayQuality::test_chapter_0_contains_all_required_frontend_data PASSED [ 39%]
backend/tests/unit/test_chapter_routines.py::TestChapterRoutines::test_chapter_file_correspondence 
backend/tests/unit/test_chapter_routines.py::TestChapterRoutines::test_chapter_file_correspondence PASSED [ 40%]
backend/tests/unit/test_chapter_routines.py::TestChapterRoutines::test_unique_layout_per_page PASSED [ 40%]
backend/tests/unit/test_chapter_routines.py::TestChapterRoutines::test_z_generate_design_compliance_report PASSED [ 40%]
backend/tests/unit/test_chapters.py::TestChapters::test_chapter_generation PASSED [ 40%]
backend/tests/unit/test_chapters.py::TestChapters::test_chapter_registry PASSED [ 41%]
backend/tests/unit/test_complex_parsing.py::TestComplexParsing::test_no_classes_layout PASSED [ 41%]
backend/tests/unit/test_config_api.py::test_get_full_config PASSED       [ 41%]
backend/tests/unit/test_config_api.py::test_get_config_section PASSED    [ 42%]
backend/tests/unit/test_config_api.py::test_get_config_section_not_found PASSED [ 42%]
backend/tests/unit/test_config_api.py::test_get_config_value PASSED      [ 42%]
backend/tests/unit/test_config_api.py::test_update_config_bulk PASSED    [ 43%]
backend/tests/unit/test_config_api.py::test_update_config_value PASSED   [ 43%]
backend/tests/unit/test_config_api.py::test_update_config_invalid_section PASSED [ 43%]
backend/tests/unit/test_config_api.py::test_update_config_invalid_key PASSED [ 44%]
backend/tests/unit/test_display_units.py::TestDisplayUnits::test_derived_metrics_consistency PASSED [ 44%]
backend/tests/unit/test_display_units.py::TestDisplayUnits::test_no_duplicate_m2_in_hero PASSED [ 44%]
backend/tests/unit/test_display_units.py::TestDisplayUnits::test_no_duplicate_m2_in_metrics PASSED [ 45%]
backend/tests/unit/test_display_units.py::TestDisplayUnits::test_price_m2_calculation_accuracy PASSED [ 45%]
backend/tests/unit/test_domain_models.py::TestDomainModels::test_chapter_output_flexibility PASSED [ 45%]
backend/tests/unit/test_domain_models.py::TestDomainModels::test_property_core_defaults PASSED [ 46%]
backend/tests/unit/test_domain_models.py::TestDomainModels::test_ui_component_structure PASSED [ 46%]
backend/tests/unit/test_dynamic_chapters.py::TestDynamicChapters::test_all_chapters_generate_modern_dashboard 
backend/tests/unit/test_dynamic_chapters.py::TestDynamicChapters::test_all_chapters_generate_modern_dashboard PASSED [ 46%]
backend/tests/unit/test_dynamic_chapters.py::TestDynamicChapters::test_chapter_titles PASSED [ 47%]
backend/tests/unit/test_dynamic_chapters.py::TestDynamicChapters::test_dynamic_intelligence_integration PASSED [ 47%]
backend/tests/unit/test_explore_insights.py::TestExploreInsights::test_capture_chapter_insights PASSED [ 47%]
backend/tests/unit/test_frontend_compatibility.py::TestRegression::test_chapter_data_bridging PASSED [ 48%]
backend/tests/unit/test_frontend_compatibility.py::TestRegression::test_chapter_id_present PASSED [ 48%]
backend/tests/unit/test_image_upload.py::TestImageUpload::test_upload_endpoint_exists PASSED [ 48%]
backend/tests/unit/test_image_upload.py::TestImageUpload::test_upload_valid_image PASSED [ 49%]
backend/tests/unit/test_image_upload.py::TestImageUpload::test_upload_jpg_image PASSED [ 49%]
backend/tests/unit/test_image_upload.py::TestImageUpload::test_upload_non_image_file_rejected PASSED [ 49%]
backend/tests/unit/test_image_upload.py::TestImageUpload::test_upload_oversized_image_rejected PASSED [ 50%]
backend/tests/unit/test_image_upload.py::TestImageUpload::test_uploaded_file_is_accessible PASSED [ 50%]
backend/tests/unit/test_image_upload.py::TestImageUpload::test_upload_generates_unique_filenames PASSED [ 50%]
backend/tests/unit/test_image_upload.py::TestImageUpload::test_upload_preserves_file_extension PASSED [ 50%]
backend/tests/unit/test_image_upload.py::TestImageUpload::test_upload_directory_exists PASSED [ 51%]
backend/tests/unit/test_image_upload.py::TestImageUpload::test_upload_handles_special_characters_in_filename PASSED [ 51%]
backend/tests/unit/test_image_upload.py::TestImageUploadIntegration::test_paste_with_media_urls PASSED [ 51%]
backend/tests/unit/test_image_upload.py::TestImageUploadSecurity::test_upload_without_authentication PASSED [ 52%]
backend/tests/unit/test_image_upload.py::TestImageUploadSecurity::test_path_traversal_prevention PASSED [ 52%]
backend/tests/unit/test_intelligence.py::TestIntelligenceEngine::test_chapter_0_executive_summary PASSED [ 52%]
backend/tests/unit/test_intelligence.py::TestIntelligenceEngine::test_chapter_4_energy_logic PASSED [ 53%]
backend/tests/unit/test_intelligence.py::TestIntelligenceEngine::test_generate_chapter_narrative_structure PASSED [ 53%]
backend/tests/unit/test_intelligence.py::TestIntelligenceEngine::test_parse_int_helper PASSED [ 53%]
backend/tests/unit/test_modern_chapter.py::TestModernChapter::test_chapter_structure_modern PASSED [ 54%]
backend/tests/unit/test_modern_chapter.py::TestModernChapter::test_energy_chapter_layout PASSED [ 54%]
backend/tests/unit/test_modern_design_compliance.py::TestModernDesignCompliance::test_all_chapters_exist PASSED [ 54%]
backend/tests/unit/test_modern_design_compliance.py::TestModernDesignCompliance::test_data_integrity_no_placeholders PASSED [ 55%]
backend/tests/unit/test_modern_design_compliance.py::TestModernDesignCompliance::test_enriched_by_ai_check PASSED [ 55%]
backend/tests/unit/test_modern_design_compliance.py::TestModernDesignCompliance::test_modern_4k_structure_compliance 
backend/tests/unit/test_modern_design_compliance.py::TestModernDesignCompliance::test_modern_4k_structure_compliance PASSED [ 55%]
backend/tests/unit/test_narrative_quality.py::test_no_raw_data_dump_in_main_analysis PASSED [ 56%]
backend/tests/unit/test_narrative_quality.py::test_no_double_persona_info PASSED [ 56%]
backend/tests/unit/test_narrative_quality.py::test_editorial_prose_quality PASSED [ 56%]
backend/tests/unit/test_ollama_integration.py::TestProviderIntegration::test_engine_accepts_different_provider_types PASSED [ 57%]
backend/tests/unit/test_ollama_integration.py::TestProviderIntegration::test_engine_narrative_generation_with_provider_set PASSED [ 57%]
backend/tests/unit/test_ollama_integration.py::TestProviderIntegration::test_engine_narrative_generation_without_provider PASSED [ 57%]
backend/tests/unit/test_ollama_integration.py::TestProviderIntegration::test_provider_configuration_accessible_after_injection PASSED [ 58%]
backend/tests/unit/test_ollama_integration.py::TestProviderIntegration::test_provider_identity_preserved_after_injection PASSED [ 58%]
backend/tests/unit/test_ollama_integration.py::TestProviderIntegration::test_provider_injection_into_engine PASSED [ 58%]
backend/tests/unit/test_ollama_integration.py::TestPreferenceIntegration::test_fit_score_calculation_with_preferences PASSED [ 59%]
backend/tests/unit/test_ollama_integration.py::TestPreferenceIntegration::test_preferences_included_in_context PASSED [ 59%]
backend/tests/unit/test_ollama_integration.py::TestPreferenceIntegration::test_preferences_structure_preserved PASSED [ 59%]
backend/tests/unit/test_ollama_integration.py::TestMultiChapterIntegration::test_chapter_specific_logic_integration PASSED [ 60%]
backend/tests/unit/test_ollama_integration.py::TestMultiChapterIntegration::test_consistent_output_across_chapters PASSED [ 60%]
backend/tests/unit/test_ollama_integration.py::TestMultiChapterIntegration::test_data_propagation_across_chapters PASSED [ 60%]
backend/tests/unit/test_ollama_integration.py::TestProviderStateIsolation::test_provider_state_can_be_set_and_cleared PASSED [ 60%]
backend/tests/unit/test_ollama_integration.py::TestProviderStateIsolation::test_provider_state_starts_clean PASSED [ 61%]
backend/tests/unit/test_ollama_integration.py::TestErrorHandling::test_engine_handles_empty_context PASSED [ 61%]
backend/tests/unit/test_ollama_integration.py::TestErrorHandling::test_engine_handles_missing_context_data PASSED [ 61%]
backend/tests/unit/test_ollama_integration.py::TestErrorHandling::test_parse_int_handles_invalid_input PASSED [ 62%]
backend/tests/unit/test_parser.py::TestParser::test_bedroom_extraction_from_rooms PASSED [ 62%]
backend/tests/unit/test_parser.py::TestParser::test_comprehensive_field_extraction PASSED [ 62%]
backend/tests/unit/test_parser.py::TestParser::test_cross_validation_bedrooms_vs_rooms PASSED [ 63%]
backend/tests/unit/test_parser.py::TestParser::test_data_quality_report PASSED [ 63%]
backend/tests/unit/test_parser.py::TestParser::test_illogical_data_validation PASSED [ 63%]
backend/tests/unit/test_parser.py::TestParser::test_parse_real_fixture PASSED [ 64%]
backend/tests/unit/test_parser.py::TestParser::test_parse_sample PASSED  [ 64%]
backend/tests/unit/test_parser_edge_cases.py::TestParserEdgeCases::test_navigation_text_address_bug PASSED [ 64%]
backend/tests/unit/test_parser_edge_cases.py::TestParserEdgeCases::test_photo_count_as_rooms_bug PASSED [ 65%]
backend/tests/unit/test_parser_edge_cases.py::TestParserEdgeCases::test_suspicious_room_count_correction PASSED [ 65%]
backend/tests/unit/test_parser_edge_cases.py::TestParserEdgeCases::test_duplicate_m2_display_fix PASSED [ 65%]
backend/tests/unit/test_parser_edge_cases_additional.py::test_address_blocklist_ignored PASSED [ 66%]
backend/tests/unit/test_parser_edge_cases_additional.py::test_bedroom_capping PASSED [ 66%]
backend/tests/unit/test_preferences_compliance.py::TestPreferencesCompliance::test_marcel_petra_preferences_match PASSED [ 66%]
backend/tests/unit/test_preferences_compliance.py::TestPreferencesCompliance::test_missing_preferences_handling FAILED [ 67%]
backend/tests/unit/test_preferenties_vergelijking.py::TestPreferentiesVergelijking::test_vergelijking_logica PASSED [ 67%]
backend/tests/unit/test_provider_factory.py::TestProviderRegistry::test_list_providers_returns_all_registered PASSED [ 67%]
backend/tests/unit/test_provider_factory.py::TestProviderRegistry::test_registry_contains_correct_classes PASSED [ 68%]
backend/tests/unit/test_provider_factory.py::TestProviderRegistry::test_register_new_provider PASSED [ 68%]
backend/tests/unit/test_provider_factory.py::TestProviderFactory::test_create_ollama_provider_default PASSED [ 68%]
backend/tests/unit/test_provider_factory.py::TestProviderFactory::test_create_ollama_provider_custom_url PASSED [ 69%]
backend/tests/unit/test_provider_factory.py::TestProviderFactory::test_create_ollama_provider_custom_timeout PASSED [ 69%]
backend/tests/unit/test_provider_factory.py::TestProviderFactory::test_create_openai_provider_with_api_key PASSED [ 69%]
backend/tests/unit/test_provider_factory.py::TestProviderFactory::test_create_openai_provider_without_api_key_raises_error PASSED [ 70%]
backend/tests/unit/test_provider_factory.py::TestProviderFactory::test_create_anthropic_provider_with_api_key PASSED [ 70%]
backend/tests/unit/test_provider_factory.py::TestProviderFactory::test_create_anthropic_provider_without_api_key_raises_error PASSED [ 70%]
backend/tests/unit/test_provider_factory.py::TestProviderFactory::test_create_gemini_provider_with_api_key FAILED [ 70%]
backend/tests/unit/test_provider_factory.py::TestProviderFactory::test_create_gemini_provider_without_api_key_raises_error PASSED [ 71%]
backend/tests/unit/test_provider_factory.py::TestProviderFactory::test_create_unknown_provider_raises_error PASSED [ 71%]
backend/tests/unit/test_provider_factory.py::TestProviderFactory::test_create_provider_with_extra_kwargs PASSED [ 71%]
backend/tests/unit/test_provider_factory.py::TestProviderFactory::test_create_all_providers_with_valid_config FAILED [ 72%]
backend/tests/unit/test_provider_factory.py::TestProviderFactory::test_provider_factory_respects_timeout_parameter FAILED [ 72%]
backend/tests/unit/test_provider_factory.py::TestFactoryRegistryIntegration::test_factory_uses_registry_for_provider_lookup PASSED [ 72%]
backend/tests/unit/test_provider_factory.py::TestFactoryRegistryIntegration::test_custom_provider_can_be_registered_and_created PASSED [ 73%]
backend/tests/unit/test_provider_factory.py::TestFactoryRegistryIntegration::test_all_registered_providers_can_be_created FAILED [ 73%]
backend/tests/unit/test_provider_factory.py::TestProviderFactoryErrorHandling::test_none_provider_name_raises_error PASSED [ 73%]
backend/tests/unit/test_provider_factory.py::TestProviderFactoryErrorHandling::test_empty_provider_name_raises_error PASSED [ 74%]
backend/tests/unit/test_provider_factory.py::TestProviderFactoryErrorHandling::test_case_sensitive_provider_names PASSED [ 74%]
backend/tests/unit/test_provider_factory.py::TestProviderFactoryErrorHandling::test_helpful_error_message_lists_available_providers PASSED [ 74%]
backend/tests/unit/test_providers.py::TestOllamaProvider::test_ollama_initialization_default FAILED [ 75%]
backend/tests/unit/test_providers.py::TestOllamaProvider::test_ollama_initialization_custom_url PASSED [ 75%]
backend/tests/unit/test_providers.py::TestOllamaProvider::test_ollama_initialization_env_var FAILED [ 75%]
backend/tests/unit/test_providers.py::TestOllamaProvider::test_ollama_initialization_docker_env FAILED [ 76%]
backend/tests/unit/test_providers.py::TestOllamaProvider::test_ollama_name_property PASSED [ 76%]
backend/tests/unit/test_providers.py::TestOllamaProvider::test_ollama_list_models_success FAILED [ 76%]
backend/tests/unit/test_providers.py::TestOllamaProvider::test_ollama_list_models_http_error FAILED [ 77%]
backend/tests/unit/test_providers.py::TestOllamaProvider::test_ollama_list_models_connection_error FAILED [ 77%]
backend/tests/unit/test_providers.py::TestOllamaProvider::test_ollama_generate_success FAILED [ 77%]
backend/tests/unit/test_providers.py::TestOllamaProvider::test_ollama_generate_timeout FAILED [ 78%]
backend/tests/unit/test_providers.py::TestOllamaProvider::test_ollama_check_health_success FAILED [ 78%]
backend/tests/unit/test_providers.py::TestOllamaProvider::test_ollama_check_health_failure FAILED [ 78%]
backend/tests/unit/test_providers.py::TestOpenAIProvider::test_openai_initialization_with_key PASSED [ 79%]
backend/tests/unit/test_providers.py::TestOpenAIProvider::test_openai_initialization_from_env FAILED [ 79%]
backend/tests/unit/test_providers.py::TestOpenAIProvider::test_openai_initialization_no_key_raises_error FAILED [ 79%]
backend/tests/unit/test_providers.py::TestOpenAIProvider::test_openai_name_property PASSED [ 80%]
backend/tests/unit/test_providers.py::TestOpenAIProvider::test_openai_list_models PASSED [ 80%]
backend/tests/unit/test_providers.py::TestOpenAIProvider::test_openai_generate_success FAILED [ 80%]
backend/tests/unit/test_providers.py::TestOpenAIProvider::test_openai_generate_with_json_mode FAILED [ 80%]
backend/tests/unit/test_providers.py::TestOpenAIProvider::test_openai_generate_error_handling FAILED [ 81%]
backend/tests/unit/test_providers.py::TestOpenAIProvider::test_openai_check_health_success FAILED [ 81%]
backend/tests/unit/test_providers.py::TestOpenAIProvider::test_openai_check_health_failure FAILED [ 81%]
backend/tests/unit/test_providers.py::TestAnthropicProvider::test_anthropic_initialization_with_key PASSED [ 82%]
backend/tests/unit/test_providers.py::TestAnthropicProvider::test_anthropic_initialization_custom_timeout PASSED [ 82%]
backend/tests/unit/test_providers.py::TestAnthropicProvider::test_anthropic_name_property PASSED [ 82%]
backend/tests/unit/test_providers.py::TestAnthropicProvider::test_anthropic_list_models PASSED [ 83%]
backend/tests/unit/test_providers.py::TestAnthropicProvider::test_anthropic_generate_success FAILED [ 83%]
backend/tests/unit/test_providers.py::TestAnthropicProvider::test_anthropic_generate_with_json_mode FAILED [ 83%]
backend/tests/unit/test_providers.py::TestAnthropicProvider::test_anthropic_generate_timeout_error FAILED [ 84%]
backend/tests/unit/test_providers.py::TestAnthropicProvider::test_anthropic_check_health_success FAILED [ 84%]
backend/tests/unit/test_providers.py::TestAnthropicProvider::test_anthropic_check_health_failure FAILED [ 84%]
backend/tests/unit/test_providers.py::TestGeminiProvider::test_gemini_initialization_with_key FAILED [ 85%]
backend/tests/unit/test_providers.py::TestGeminiProvider::test_gemini_initialization_from_google_env FAILED [ 85%]
backend/tests/unit/test_providers.py::TestGeminiProvider::test_gemini_initialization_from_gemini_env FAILED [ 85%]
backend/tests/unit/test_providers.py::TestGeminiProvider::test_gemini_initialization_no_key_raises_error FAILED [ 86%]
backend/tests/unit/test_providers.py::TestGeminiProvider::test_gemini_name_property FAILED [ 86%]
backend/tests/unit/test_providers.py::TestGeminiProvider::test_gemini_list_models FAILED [ 86%]
backend/tests/unit/test_providers.py::TestGeminiProvider::test_gemini_generate_success FAILED [ 87%]
backend/tests/unit/test_providers.py::TestGeminiProvider::test_gemini_generate_with_json_mode FAILED [ 87%]
backend/tests/unit/test_providers.py::TestGeminiProvider::test_gemini_generate_error_handling FAILED [ 87%]
backend/tests/unit/test_providers.py::TestGeminiProvider::test_gemini_check_health_success FAILED [ 88%]
backend/tests/unit/test_providers.py::TestGeminiProvider::test_gemini_check_health_no_api_key FAILED [ 88%]
backend/tests/unit/test_providers.py::TestGeminiProvider::test_gemini_check_health_failure FAILED [ 88%]
backend/tests/unit/test_providers.py::TestProviderInterface::test_all_providers_implement_interface FAILED [ 89%]
backend/tests/unit/test_providers.py::TestProviderInterface::test_all_providers_have_name_property FAILED [ 89%]
backend/tests/unit/test_providers.py::TestMultiProviderIntegration::test_all_available_providers_can_generate PASSED [ 89%]
backend/tests/unit/test_utils.py::TestParsingUtilities::test_parse_float_invalid PASSED [ 90%]
backend/tests/unit/test_utils.py::TestParsingUtilities::test_parse_float_valid PASSED [ 90%]
backend/tests/unit/test_utils.py::TestParsingUtilities::test_parse_int_custom_default PASSED [ 90%]
backend/tests/unit/test_utils.py::TestParsingUtilities::test_parse_int_formatted_numbers PASSED [ 90%]
backend/tests/unit/test_utils.py::TestParsingUtilities::test_parse_int_invalid_inputs PASSED [ 91%]
backend/tests/unit/test_utils.py::TestParsingUtilities::test_parse_int_valid_numbers PASSED [ 91%]
backend/tests/unit/test_utils.py::TestValidationUtilities::test_validate_bedrooms_explicit_count PASSED [ 91%]
backend/tests/unit/test_utils.py::TestValidationUtilities::test_validate_bedrooms_minimum PASSED [ 92%]
backend/tests/unit/test_utils.py::TestValidationUtilities::test_validate_bedrooms_normal_range PASSED [ 92%]
backend/tests/unit/test_utils.py::TestValidationUtilities::test_validate_bedrooms_upper_bound PASSED [ 92%]
backend/tests/unit/test_utils.py::TestValidationUtilities::test_validate_living_area_bounds PASSED [ 93%]
backend/tests/unit/test_utils.py::TestValidationUtilities::test_validate_living_area_normal PASSED [ 93%]
backend/tests/unit/test_utils.py::TestSafetyUtilities::test_ensure_grid_layout_existing PASSED [ 93%]
backend/tests/unit/test_utils.py::TestSafetyUtilities::test_ensure_grid_layout_missing PASSED [ 94%]
backend/tests/unit/test_utils.py::TestSafetyUtilities::test_safe_get_existing_key PASSED [ 94%]
backend/tests/unit/test_utils.py::TestSafetyUtilities::test_safe_get_missing_key PASSED [ 94%]
backend/tests/unit/test_utils.py::TestSafetyUtilities::test_safe_get_none_value PASSED [ 95%]
backend/tests/unit/test_utils.py::TestEdgeCases::test_parse_int_extreme_values PASSED [ 95%]
backend/tests/unit/test_utils.py::TestEdgeCases::test_validate_bedrooms_edge_cases PASSED [ 95%]
backend/tests/unit/test_utils.py::TestEdgeCases::test_validate_living_area_warnings PASSED [ 96%]
backend/tests/unit/test_variable_strategy.py::TestPropertyCoreData::test_property_core_creation PASSED [ 96%]
backend/tests/unit/test_variable_strategy.py::TestPropertyCoreData::test_preference_matching_marcel PASSED [ 96%]
backend/tests/unit/test_variable_strategy.py::TestPropertyCoreData::test_preference_matching_petra PASSED [ 97%]
backend/tests/unit/test_variable_strategy.py::TestPropertyCoreData::test_combined_match_score PASSED [ 97%]
backend/tests/unit/test_variable_strategy.py::TestPropertyCoreData::test_preference_indicator_generation PASSED [ 97%]
backend/tests/unit/test_variable_strategy.py::TestChapterVariableStrategy::test_chapter_0_shows_core_data PASSED [ 98%]
backend/tests/unit/test_variable_strategy.py::TestChapterVariableStrategy::test_other_chapters_hide_core_data PASSED [ 98%]
backend/tests/unit/test_variable_strategy.py::TestChapterVariableStrategy::test_chapter_2_preference_variables PASSED [ 98%]
backend/tests/unit/test_variable_strategy.py::TestChapterVariableStrategy::test_variable_filtering PASSED [ 99%]
backend/tests/unit/test_variable_strategy.py::TestChapterVariableStrategy::test_ai_prompt_generation FAILED [ 99%]
backend/tests/unit/test_variable_strategy.py::TestChapterVariableStrategy::test_no_variable_overlap PASSED [ 99%]
backend/tests/unit/test_variable_strategy.py::TestIntegration::test_complete_flow PASSED [100%]

=================================== FAILURES ===================================
________________ TestDockerSync.test_ensure_latest_docker_build ________________
backend/tests/integration/test_docker_sync.py:56: in test_ensure_latest_docker_build
    subprocess.run(["docker-compose", "up", "-d", "app"], cwd=project_root, check=True)
/Library/Frameworks/Python.framework/Versions/3.11/lib/python3.11/subprocess.py:571: in run
    raise CalledProcessError(retcode, process.args,
E   subprocess.CalledProcessError: Command '['docker-compose', 'up', '-d', 'app']' returned non-zero exit status 1.

During handling of the above exception, another exception occurred:
backend/tests/integration/test_docker_sync.py:64: in test_ensure_latest_docker_build
    self.fail(f"Docker command failed: {e}")
E   AssertionError: Docker command failed: Command '['docker-compose', 'up', '-d', 'app']' returned non-zero exit status 1.
----------------------------- Captured stdout call -----------------------------
Hash mismatch! Current: 227f0d57..., Stored: 6a8d7a47...
Triggering Docker rebuild...
#0 building with "desktop-linux" instance using docker driver

#1 [app internal] load build definition from Dockerfile
#1 transferring dockerfile: 1.31kB done
#1 DONE 0.0s

#2 [app internal] load metadata for docker.io/library/node:20-slim
#2 ...

#3 [app internal] load metadata for docker.io/library/python:3.11-slim
#3 DONE 0.8s

#2 [app internal] load metadata for docker.io/library/node:20-slim
#2 DONE 0.8s

#4 [app internal] load .dockerignore
#4 transferring context: 2B done
#4 DONE 0.0s

#5 [app frontend-builder 1/6] FROM docker.io/library/node:20-slim@sha256:1b38aaddff63cd0d3a9b5b03863a71fd33ee62047dd2e915f494d96b4b9c18cc
#5 DONE 0.0s

#6 [app stage-1 1/8] FROM docker.io/library/python:3.11-slim@sha256:158caf0e080e2cd74ef2879ed3c4e697792ee65251c8208b7afb56683c32ea6c
#6 DONE 0.0s

#7 [app internal] load build context
#7 transferring context: 2.85MB 0.7s done
#7 DONE 0.8s

#8 [app stage-1 3/8] WORKDIR /app
#8 CACHED

#9 [app stage-1 2/8] RUN apt-get update && apt-get install -y     build-essential     python3-dev     python3-pip     python3-setuptools     python3-wheel     python3-cffi     libcairo2     libpango-1.0-0     libpangocairo-1.0-0     libgdk-pixbuf-2.0-0     libffi-dev     shared-mime-info     fonts-liberation     curl     && rm -rf /var/lib/apt/lists/*
#9 CACHED

#10 [app stage-1 4/8] COPY backend/requirements.txt .
#10 CACHED

#11 [app frontend-builder 2/6] WORKDIR /src
#11 CACHED

#12 [app frontend-builder 4/6] RUN npm ci
#12 CACHED

#13 [app frontend-builder 5/6] COPY frontend/ ./
#13 CACHED

#14 [app frontend-builder 3/6] COPY frontend/package*.json ./
#14 CACHED

#15 [app stage-1 5/8] RUN pip install --no-cache-dir -r requirements.txt
#15 CACHED

#16 [app frontend-builder 6/6] RUN npm run build
#16 CACHED

#17 [app stage-1 6/8] COPY backend/ ./backend/
#17 DONE 0.0s

#18 [app stage-1 7/8] COPY --from=frontend-builder /src/dist ./backend/frontend/dist
#18 DONE 0.0s

#19 [app stage-1 8/8] WORKDIR /app/backend
#19 DONE 0.0s

#20 [app] exporting to image
#20 exporting layers 0.0s done
#20 writing image sha256:6e3804100acdbd7f5a440ed0d1c89b1e76be1fa3a2c0c410f25918b55f5b14ea done
#20 naming to docker.io/library/funda-app-app done
#20 DONE 0.0s
----------------------------- Captured stderr call -----------------------------
time="2025-12-23T14:01:51+01:00" level=warning msg="The \"OPENAI_API_KEY\" variable is not set. Defaulting to a blank string."
time="2025-12-23T14:01:51+01:00" level=warning msg="The \"ANTHROPIC_API_KEY\" variable is not set. Defaulting to a blank string."
time="2025-12-23T14:01:51+01:00" level=warning msg="The \"GEMINI_API_KEY\" variable is not set. Defaulting to a blank string."
time="2025-12-23T14:01:52+01:00" level=warning msg="The \"OPENAI_API_KEY\" variable is not set. Defaulting to a blank string."
time="2025-12-23T14:01:52+01:00" level=warning msg="The \"ANTHROPIC_API_KEY\" variable is not set. Defaulting to a blank string."
time="2025-12-23T14:01:52+01:00" level=warning msg="The \"GEMINI_API_KEY\" variable is not set. Defaulting to a blank string."
 Container ollama  Creating
Error response from daemon: Conflict. The container name "/ollama" is already in use by container "11b7cecaf91509b1529fffcef9b84fd547ce39e229318765e072410c3c70546c". You have to remove (or rename) that container to be able to reuse that name.
__________________ TestIntegration.test_full_flow_with_paste ___________________
backend/tests/integration/test_integration.py:61: in test_full_flow_with_paste
    self.assertTrue(len(chapters) > 0)
E   AssertionError: False is not true
----------------------------- Captured stdout call -----------------------------

[Test] Starting Run...
[Test] Pasting HTML content...
[Test] Fetching Report...
------------------------------ Captured log call -------------------------------
ERROR    ai.provider_factory:provider_factory.py:72 Failed to instantiate gemini provider: GEMINI_API_KEY or GOOGLE_API_KEY must be set for Gemini provider
ERROR    main:main.py:226 ✗ Failed to initialize AI Provider (gemini): GEMINI_API_KEY or GOOGLE_API_KEY must be set for Gemini provider
______________________ test_chapter_0_fallback_comparison ______________________
backend/tests/test_ai_preference_matching.py:39: in test_chapter_0_fallback_comparison
    assert "Initiële scan" in result["comparison"]["marcel"]
E   assert 'Initi\xeble scan' in "De woning biedt solide ROI-potentieel door de combinatie van prijs en metrage. Marcel's focus op tech-infra vereist een check op de huidige meterkast en isolatiegraad."
_________ TestNarrativeOutputSchema.test_all_text_fields_are_non_empty _________
backend/tests/unit/test_ai_schema.py:136: in test_all_text_fields_are_non_empty
    self.assertIsInstance(result[field], str)
E   AssertionError: ['Check: Asbestclausule van toepassing?', 'Advies: Bouwkundige keuring (fundering/dak).', 'Budgettip: Reserveer €20k-€40k voor verduurzaming.'] is not an instance of <class 'str'>
__________ TestNarrativeOutputSchema.test_chapter_1_schema_compliance __________
backend/tests/unit/test_ai_schema.py:51: in test_chapter_1_schema_compliance
    self.assertIsInstance(result['advice'], str)
E   AssertionError: ['Check: Asbestclausule van toepassing?', 'Advies: Bouwkundige keuring (fundering/dak).', 'Budgettip: Reserveer €20k-€40k voor verduurzaming.'] is not an instance of <class 'str'>
_____________ TestHelperFunctions.test_parse_int_helper_with_area ______________
backend/tests/unit/test_ai_schema.py:271: in test_parse_int_helper_with_area
    self.assertEqual(IntelligenceEngine._parse_int("150 m2"), 150)
E   AssertionError: 1502 != 150
_ TestModernDesignCompliance.test_modern_4k_structure_compliance (chapter='Chapter 13 (Media Bibliotheek)') _
backend/tests/unit/test_modern_design_compliance.py:44: in test_modern_4k_structure_compliance
    self.assertEqual(layout.get("layout_type"), "modern_dashboard", f"Chapter {i} layout_type mismatch")
E   AssertionError: None != 'modern_dashboard' : Chapter 13 layout_type mismatch
_________ TestPreferencesCompliance.test_missing_preferences_handling __________
backend/tests/unit/test_preferences_compliance.py:80: in test_missing_preferences_handling
    self.assertIn("Geen specifieke", narrative['main_analysis'])
E   AssertionError: 'Geen specifieke' not found in "\n        <p>De technische ambities van Marcel ondersteund door een degelijke basis. Terwijl de basisstaat geverifieerd moet worden, biedt dit object een interessant uitgangspunt voor tech-integratie.</p>\n        <p>Voor Petra is de atmosferische kwaliteit leidend. De huidige kenmerken vormen een canvas voor verdere personalisatie. De ruimtelijke 'flow' en de interactie tussen de verschillende vertrekken beloven een woonbeleving die goed resoneert met haar zoekprofiel.</p>\n        "
_________ TestProviderFactory.test_create_gemini_provider_with_api_key _________
backend/tests/unit/test_provider_factory.py:548: in test_create_gemini_provider_with_api_key
    with patch("google.generativeai.configure"):
         ^^^^^
E   NameError: name 'patch' is not defined
_______ TestProviderFactory.test_create_all_providers_with_valid_config ________
backend/tests/unit/test_provider_factory.py:590: in test_create_all_providers_with_valid_config
    with patch("google.generativeai.configure"):
         ^^^^^
E   NameError: name 'patch' is not defined
_____ TestProviderFactory.test_provider_factory_respects_timeout_parameter _____
backend/tests/unit/test_provider_factory.py:609: in test_provider_factory_respects_timeout_parameter
    with patch("google.generativeai.configure"):
         ^^^^^
E   NameError: name 'patch' is not defined
_ TestFactoryRegistryIntegration.test_all_registered_providers_can_be_created __
backend/tests/unit/test_provider_factory.py:693: in test_all_registered_providers_can_be_created
    with patch("google.generativeai.configure"):
         ^^^^^
E   NameError: name 'patch' is not defined
____________ TestOllamaProvider.test_ollama_initialization_default _____________
backend/tests/unit/test_providers.py:533: in test_ollama_initialization_default
    with patch.dict(os.environ, {}, clear=True):
         ^^^^^
E   NameError: name 'patch' is not defined
____________ TestOllamaProvider.test_ollama_initialization_env_var _____________
backend/tests/unit/test_providers.py:548: in test_ollama_initialization_env_var
    with patch.dict(os.environ, {"OLLAMA_BASE_URL": "http://env-ollama:9999"}):
         ^^^^^
E   NameError: name 'patch' is not defined
___________ TestOllamaProvider.test_ollama_initialization_docker_env ___________
backend/tests/unit/test_providers.py:554: in test_ollama_initialization_docker_env
    with patch.dict(os.environ, {}, clear=True):
         ^^^^^
E   NameError: name 'patch' is not defined
______________ TestOllamaProvider.test_ollama_list_models_success ______________
backend/tests/unit/test_providers.py:569: in test_ollama_list_models_success
    mock_response = Mock()
                    ^^^^
E   NameError: name 'Mock' is not defined
____________ TestOllamaProvider.test_ollama_list_models_http_error _____________
backend/tests/unit/test_providers.py:598: in test_ollama_list_models_http_error
    with patch("httpx.Client") as mock_client:
         ^^^^^
E   NameError: name 'patch' is not defined
_________ TestOllamaProvider.test_ollama_list_models_connection_error __________
backend/tests/unit/test_providers.py:617: in test_ollama_list_models_connection_error
    with patch("httpx.Client") as mock_client:
         ^^^^^
E   NameError: name 'patch' is not defined
_______________ TestOllamaProvider.test_ollama_generate_success ________________
backend/tests/unit/test_providers.py:635: in test_ollama_generate_success
    mock_response = Mock()
                    ^^^^
E   NameError: name 'Mock' is not defined
_______________ TestOllamaProvider.test_ollama_generate_timeout ________________
backend/tests/unit/test_providers.py:659: in test_ollama_generate_timeout
    with patch("httpx.AsyncClient") as mock_client:
         ^^^^^
E   NameError: name 'patch' is not defined
_____________ TestOllamaProvider.test_ollama_check_health_success ______________
backend/tests/unit/test_providers.py:674: in test_ollama_check_health_success
    mock_response = Mock()
                    ^^^^
E   NameError: name 'Mock' is not defined
_____________ TestOllamaProvider.test_ollama_check_health_failure ______________
backend/tests/unit/test_providers.py:693: in test_ollama_check_health_failure
    with patch("httpx.AsyncClient") as mock_client:
         ^^^^^
E   NameError: name 'patch' is not defined
____________ TestOpenAIProvider.test_openai_initialization_from_env ____________
backend/tests/unit/test_providers.py:721: in test_openai_initialization_from_env
    with patch.dict(os.environ, {"OPENAI_API_KEY": "env-key-456"}):
         ^^^^^
E   NameError: name 'patch' is not defined
______ TestOpenAIProvider.test_openai_initialization_no_key_raises_error _______
backend/tests/unit/test_providers.py:727: in test_openai_initialization_no_key_raises_error
    with patch.dict(os.environ, {}, clear=True):
         ^^^^^
E   NameError: name 'patch' is not defined
_______________ TestOpenAIProvider.test_openai_generate_success ________________
backend/tests/unit/test_providers.py:753: in test_openai_generate_success
    mock_message = Mock()
                   ^^^^
E   NameError: name 'Mock' is not defined
____________ TestOpenAIProvider.test_openai_generate_with_json_mode ____________
backend/tests/unit/test_providers.py:777: in test_openai_generate_with_json_mode
    mock_message = Mock()
                   ^^^^
E   NameError: name 'Mock' is not defined
____________ TestOpenAIProvider.test_openai_generate_error_handling ____________
backend/tests/unit/test_providers.py:800: in test_openai_generate_error_handling
    provider.client.chat.completions.create = AsyncMock(
                                              ^^^^^^^^^
E   NameError: name 'AsyncMock' is not defined
_____________ TestOpenAIProvider.test_openai_check_health_success ______________
backend/tests/unit/test_providers.py:810: in test_openai_check_health_success
    with patch("sys.modules", new={**sys.modules}):
         ^^^^^
E   NameError: name 'patch' is not defined
_____________ TestOpenAIProvider.test_openai_check_health_failure ______________
backend/tests/unit/test_providers.py:823: in test_openai_check_health_failure
    with patch("sys.modules", new={**sys.modules}):
         ^^^^^
E   NameError: name 'patch' is not defined
____________ TestAnthropicProvider.test_anthropic_generate_success _____________
backend/tests/unit/test_providers.py:874: in test_anthropic_generate_success
    mock_text_block = Mock()
                      ^^^^
E   NameError: name 'Mock' is not defined
_________ TestAnthropicProvider.test_anthropic_generate_with_json_mode _________
backend/tests/unit/test_providers.py:895: in test_anthropic_generate_with_json_mode
    mock_text_block = Mock()
                      ^^^^
E   NameError: name 'Mock' is not defined
_________ TestAnthropicProvider.test_anthropic_generate_timeout_error __________
backend/tests/unit/test_providers.py:916: in test_anthropic_generate_timeout_error
    error = MockAPITimeoutError("timeout")
            ^^^^^^^^^^^^^^^^^^^
E   NameError: name 'MockAPITimeoutError' is not defined
__________ TestAnthropicProvider.test_anthropic_check_health_success ___________
backend/tests/unit/test_providers.py:927: in test_anthropic_check_health_success
    provider.client.models.list = AsyncMock(return_value=Mock())
                                  ^^^^^^^^^
E   NameError: name 'AsyncMock' is not defined
__________ TestAnthropicProvider.test_anthropic_check_health_failure ___________
backend/tests/unit/test_providers.py:939: in test_anthropic_check_health_failure
    error = MockAPIError("API error")
            ^^^^^^^^^^^^
E   NameError: name 'MockAPIError' is not defined
____________ TestGeminiProvider.test_gemini_initialization_with_key ____________
backend/tests/unit/test_providers.py:955: in test_gemini_initialization_with_key
    with patch("google.generativeai.configure"):
         ^^^^^
E   NameError: name 'patch' is not defined
________ TestGeminiProvider.test_gemini_initialization_from_google_env _________
backend/tests/unit/test_providers.py:963: in test_gemini_initialization_from_google_env
    with patch.dict(os.environ, {"GOOGLE_API_KEY": "google-env-key"}):
         ^^^^^
E   NameError: name 'patch' is not defined
________ TestGeminiProvider.test_gemini_initialization_from_gemini_env _________
backend/tests/unit/test_providers.py:970: in test_gemini_initialization_from_gemini_env
    with patch.dict(os.environ, {"GEMINI_API_KEY": "gemini-env-key"}, clear=True):
         ^^^^^
E   NameError: name 'patch' is not defined
______ TestGeminiProvider.test_gemini_initialization_no_key_raises_error _______
backend/tests/unit/test_providers.py:977: in test_gemini_initialization_no_key_raises_error
    with patch.dict(os.environ, {}, clear=True):
         ^^^^^
E   NameError: name 'patch' is not defined
_________________ TestGeminiProvider.test_gemini_name_property _________________
backend/tests/unit/test_providers.py:983: in test_gemini_name_property
    with patch("google.generativeai.configure"):
         ^^^^^
E   NameError: name 'patch' is not defined
__________________ TestGeminiProvider.test_gemini_list_models __________________
backend/tests/unit/test_providers.py:989: in test_gemini_list_models
    with patch("google.generativeai.configure"):
         ^^^^^
E   NameError: name 'patch' is not defined
_______________ TestGeminiProvider.test_gemini_generate_success ________________
backend/tests/unit/test_providers.py:1000: in test_gemini_generate_success
    with patch("google.genai.Client"):
         ^^^^^
E   NameError: name 'patch' is not defined
____________ TestGeminiProvider.test_gemini_generate_with_json_mode ____________
backend/tests/unit/test_providers.py:1019: in test_gemini_generate_with_json_mode
    with patch("google.genai.Client"):
         ^^^^^
E   NameError: name 'patch' is not defined
____________ TestGeminiProvider.test_gemini_generate_error_handling ____________
backend/tests/unit/test_providers.py:1037: in test_gemini_generate_error_handling
    with patch("google.genai.Client"):
         ^^^^^
E   NameError: name 'patch' is not defined
_____________ TestGeminiProvider.test_gemini_check_health_success ______________
backend/tests/unit/test_providers.py:1047: in test_gemini_check_health_success
    with patch("google.genai.Client"):
         ^^^^^
E   NameError: name 'patch' is not defined
____________ TestGeminiProvider.test_gemini_check_health_no_api_key ____________
backend/tests/unit/test_providers.py:1063: in test_gemini_check_health_no_api_key
    with patch("google.genai.Client"):
         ^^^^^
E   NameError: name 'patch' is not defined
_____________ TestGeminiProvider.test_gemini_check_health_failure ______________
backend/tests/unit/test_providers.py:1073: in test_gemini_check_health_failure
    with patch("google.genai.Client"):
         ^^^^^
E   NameError: name 'patch' is not defined
_________ TestProviderInterface.test_all_providers_implement_interface _________
backend/tests/unit/test_providers.py:1091: in test_all_providers_implement_interface
    with patch("google.generativeai.configure"):
         ^^^^^
E   NameError: name 'patch' is not defined
_________ TestProviderInterface.test_all_providers_have_name_property __________
backend/tests/unit/test_providers.py:1108: in test_all_providers_have_name_property
    with patch("google.generativeai.configure"):
         ^^^^^
E   NameError: name 'patch' is not defined
____________ TestChapterVariableStrategy.test_ai_prompt_generation _____________
backend/tests/unit/test_variable_strategy.py:221: in test_ai_prompt_generation
    assert 'ALL core property data' in ch0_prompt
E   assert 'ALL core property data' in "\n    Act as a high-end Real Estate Strategist giving an Executive Summary. \n    You MUST provide a narrative that balances Marcel's strategic tech/ROI needs with Petra's atmospheric lifestyle needs.\n    Compare the property's core specs (price, area, label) against their combined long-term goals.\n    Extract Marcel & Petra match percentages and justify them.\n    "
=========================== short test summary info ============================
FAILED backend/tests/integration/test_docker_sync.py::TestDockerSync::test_ensure_latest_docker_build - AssertionError: Docker command failed: Command '['docker-compose', 'up', '-d', 'app']' returned non-zero exit status 1.
FAILED backend/tests/integration/test_integration.py::TestIntegration::test_full_flow_with_paste - AssertionError: False is not true
FAILED backend/tests/test_ai_preference_matching.py::test_chapter_0_fallback_comparison - assert 'Initi\xeble scan' in "De woning biedt solide ROI-potentieel door de combinatie van prijs en metrage. Marcel's focus op tech-infra vereist een check op de huidige meterkast en isolatiegraad."
FAILED backend/tests/unit/test_ai_schema.py::TestNarrativeOutputSchema::test_all_text_fields_are_non_empty - AssertionError: ['Check: Asbestclausule van toepassing?', 'Advies: Bouwkundige keuring (fundering/dak).', 'Budgettip: Reserveer €20k-€40k voor verduurzaming.'] is not an instance of <class 'str'>
FAILED backend/tests/unit/test_ai_schema.py::TestNarrativeOutputSchema::test_chapter_1_schema_compliance - AssertionError: ['Check: Asbestclausule van toepassing?', 'Advies: Bouwkundige keuring (fundering/dak).', 'Budgettip: Reserveer €20k-€40k voor verduurzaming.'] is not an instance of <class 'str'>
FAILED backend/tests/unit/test_ai_schema.py::TestHelperFunctions::test_parse_int_helper_with_area - AssertionError: 1502 != 150
SUBFAILED(chapter='Chapter 13 (Media Bibliotheek)') backend/tests/unit/test_modern_design_compliance.py::TestModernDesignCompliance::test_modern_4k_structure_compliance - AssertionError: None != 'modern_dashboard' : Chapter 13 layout_type mismatch
FAILED backend/tests/unit/test_preferences_compliance.py::TestPreferencesCompliance::test_missing_preferences_handling - AssertionError: 'Geen specifieke' not found in "\n        <p>De technische ambities van Marcel ondersteund door een degelijke basis. Terwijl de basisstaat geverifieerd moet worden, biedt dit object een interessant uitgangspunt voor tech-integratie.</p>\n        <p>Voor Petra is de atmosferische kwaliteit leidend. De huidige kenmerken vormen een canvas voor verdere personalisatie. De ruimtelijke 'flow' en de interactie tussen de verschillende vertrekken beloven een woonbeleving die goed resoneert met haar zoekprofiel.</p>\n        "
FAILED backend/tests/unit/test_provider_factory.py::TestProviderFactory::test_create_gemini_provider_with_api_key - NameError: name 'patch' is not defined
FAILED backend/tests/unit/test_provider_factory.py::TestProviderFactory::test_create_all_providers_with_valid_config - NameError: name 'patch' is not defined
FAILED backend/tests/unit/test_provider_factory.py::TestProviderFactory::test_provider_factory_respects_timeout_parameter - NameError: name 'patch' is not defined
FAILED backend/tests/unit/test_provider_factory.py::TestFactoryRegistryIntegration::test_all_registered_providers_can_be_created - NameError: name 'patch' is not defined
FAILED backend/tests/unit/test_providers.py::TestOllamaProvider::test_ollama_initialization_default - NameError: name 'patch' is not defined
FAILED backend/tests/unit/test_providers.py::TestOllamaProvider::test_ollama_initialization_env_var - NameError: name 'patch' is not defined
FAILED backend/tests/unit/test_providers.py::TestOllamaProvider::test_ollama_initialization_docker_env - NameError: name 'patch' is not defined
FAILED backend/tests/unit/test_providers.py::TestOllamaProvider::test_ollama_list_models_success - NameError: name 'Mock' is not defined
FAILED backend/tests/unit/test_providers.py::TestOllamaProvider::test_ollama_list_models_http_error - NameError: name 'patch' is not defined
FAILED backend/tests/unit/test_providers.py::TestOllamaProvider::test_ollama_list_models_connection_error - NameError: name 'patch' is not defined
FAILED backend/tests/unit/test_providers.py::TestOllamaProvider::test_ollama_generate_success - NameError: name 'Mock' is not defined
FAILED backend/tests/unit/test_providers.py::TestOllamaProvider::test_ollama_generate_timeout - NameError: name 'patch' is not defined
FAILED backend/tests/unit/test_providers.py::TestOllamaProvider::test_ollama_check_health_success - NameError: name 'Mock' is not defined
FAILED backend/tests/unit/test_providers.py::TestOllamaProvider::test_ollama_check_health_failure - NameError: name 'patch' is not defined
FAILED backend/tests/unit/test_providers.py::TestOpenAIProvider::test_openai_initialization_from_env - NameError: name 'patch' is not defined
FAILED backend/tests/unit/test_providers.py::TestOpenAIProvider::test_openai_initialization_no_key_raises_error - NameError: name 'patch' is not defined
FAILED backend/tests/unit/test_providers.py::TestOpenAIProvider::test_openai_generate_success - NameError: name 'Mock' is not defined
FAILED backend/tests/unit/test_providers.py::TestOpenAIProvider::test_openai_generate_with_json_mode - NameError: name 'Mock' is not defined
FAILED backend/tests/unit/test_providers.py::TestOpenAIProvider::test_openai_generate_error_handling - NameError: name 'AsyncMock' is not defined
FAILED backend/tests/unit/test_providers.py::TestOpenAIProvider::test_openai_check_health_success - NameError: name 'patch' is not defined
FAILED backend/tests/unit/test_providers.py::TestOpenAIProvider::test_openai_check_health_failure - NameError: name 'patch' is not defined
FAILED backend/tests/unit/test_providers.py::TestAnthropicProvider::test_anthropic_generate_success - NameError: name 'Mock' is not defined
FAILED backend/tests/unit/test_providers.py::TestAnthropicProvider::test_anthropic_generate_with_json_mode - NameError: name 'Mock' is not defined
FAILED backend/tests/unit/test_providers.py::TestAnthropicProvider::test_anthropic_generate_timeout_error - NameError: name 'MockAPITimeoutError' is not defined
FAILED backend/tests/unit/test_providers.py::TestAnthropicProvider::test_anthropic_check_health_success - NameError: name 'AsyncMock' is not defined
FAILED backend/tests/unit/test_providers.py::TestAnthropicProvider::test_anthropic_check_health_failure - NameError: name 'MockAPIError' is not defined
FAILED backend/tests/unit/test_providers.py::TestGeminiProvider::test_gemini_initialization_with_key - NameError: name 'patch' is not defined
FAILED backend/tests/unit/test_providers.py::TestGeminiProvider::test_gemini_initialization_from_google_env - NameError: name 'patch' is not defined
FAILED backend/tests/unit/test_providers.py::TestGeminiProvider::test_gemini_initialization_from_gemini_env - NameError: name 'patch' is not defined
FAILED backend/tests/unit/test_providers.py::TestGeminiProvider::test_gemini_initialization_no_key_raises_error - NameError: name 'patch' is not defined
FAILED backend/tests/unit/test_providers.py::TestGeminiProvider::test_gemini_name_property - NameError: name 'patch' is not defined
FAILED backend/tests/unit/test_providers.py::TestGeminiProvider::test_gemini_list_models - NameError: name 'patch' is not defined
FAILED backend/tests/unit/test_providers.py::TestGeminiProvider::test_gemini_generate_success - NameError: name 'patch' is not defined
FAILED backend/tests/unit/test_providers.py::TestGeminiProvider::test_gemini_generate_with_json_mode - NameError: name 'patch' is not defined
FAILED backend/tests/unit/test_providers.py::TestGeminiProvider::test_gemini_generate_error_handling - NameError: name 'patch' is not defined
FAILED backend/tests/unit/test_providers.py::TestGeminiProvider::test_gemini_check_health_success - NameError: name 'patch' is not defined
FAILED backend/tests/unit/test_providers.py::TestGeminiProvider::test_gemini_check_health_no_api_key - NameError: name 'patch' is not defined
FAILED backend/tests/unit/test_providers.py::TestGeminiProvider::test_gemini_check_health_failure - NameError: name 'patch' is not defined
FAILED backend/tests/unit/test_providers.py::TestProviderInterface::test_all_providers_implement_interface - NameError: name 'patch' is not defined
FAILED backend/tests/unit/test_providers.py::TestProviderInterface::test_all_providers_have_name_property - NameError: name 'patch' is not defined
FAILED backend/tests/unit/test_variable_strategy.py::TestChapterVariableStrategy::test_ai_prompt_generation - assert 'ALL core property data' in "\n    Act as a high-end Real Estate Strategist giving an Executive Summary. \n    You MUST provide a narrative that balances Marcel's strategic tech/ROI needs with Petra's atmospheric lifestyle needs.\n    Compare the property's core specs (price, area, label) against their combined long-term goals.\n    Extract Marcel & Petra match percentages and justify them.\n    "
====== 49 failed, 262 passed, 541 warnings, 54 subtests passed in 19.88s =======
